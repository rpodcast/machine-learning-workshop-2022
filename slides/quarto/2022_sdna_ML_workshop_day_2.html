<!DOCTYPE html>
<html lang="en"><head>
<script src="2022_sdna_ML_workshop_day_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/tabby.min.js"></script>
<script src="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/popper.min.js"></script>
<script src="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="2022_sdna_ML_workshop_day_2_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.0.36">

  <meta name="author" content="Sydeaka Watson">
  <title>GSS / SDnA ML</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
  <script src="2022_sdna_ML_workshop_day_2_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
  <link href="2022_sdna_ML_workshop_day_2_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
  <script src="2022_sdna_ML_workshop_day_2_files/libs/datatables-binding-0.25/datatables.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="2022_sdna_ML_workshop_day_2_files/libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="2022_sdna_ML_workshop_day_2_files/libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
  <script src="2022_sdna_ML_workshop_day_2_files/libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
  <link href="2022_sdna_ML_workshop_day_2_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
  <script src="2022_sdna_ML_workshop_day_2_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">GSS / SDnA ML</h1>
  <p class="subtitle">Workshop Day 2: ML Lecture</p>
  <p class="author">Sydeaka Watson</p>
</section>

<section id="outline" class="slide level2">
<h2>Outline</h2>
<ul>
<li><p>Introduction</p></li>
<li><p>Algorithms</p></li>
<li><p>Tools</p></li>
<li><p>Principles and best practices</p></li>
<li><p>Resources</p></li>
</ul>
</section>
<section id="this-workshop-is..." class="slide level2">
<h2>This workshop is...</h2>
<ul>
<li><p>A <strong>gentle introduction</strong> to machine learning concepts, algorithms, tools</p></li>
<li><p>An opportunity to use popular ML tools on real datasets for clinical&nbsp;and pre-clinical use-cases</p></li>
</ul>
</section>
<section id="this-workshop-is-not..." class="slide level2">
<h2>This workshop is NOT...</h2>
<ul>
<li><p>A <strong>comprehensive</strong> overview of all machine learning concepts, algorithms, tools, use cases, etc.</p></li>
<li><p>For more in-depth study, I recommend that you review the supplementary materials linked at the end of the Day 2 and Day 3 slides.</p></li>
<li><p>If interested in learning about more advanced ML use cases, AADS invites you to attend the upcoming AADS AI / ML workshop later this fall (contact Haoda Fu for details)</p></li>
</ul>
</section>
<section id="about-me" class="slide level2">
<h2>About Me</h2>
<ul>
<li><p><strong>Current role</strong>: Senior Advisor - Innovative Sciences in SDnA/GSS</p></li>
<li><p><strong>Education</strong>: Ph.D.&nbsp;Statistics, Baylor University, 2011</p></li>
<li><p><strong>Experience</strong>:</p>
<ul>
<li><p>Biostatistician – Los Alamos National Laboratory, University of Chicago Medicine</p></li>
<li><p>Data Scentist – AT&amp;T, Elicit Insights (consulting firm), Eli Lilly (2020-present)</p></li>
</ul></li>
<li><p><strong>Skills</strong>: R / Python; Statistics; Machine Learning; Shiny app development</p></li>
<li><p><strong>Current residence</strong>: Dallas, Texas</p></li>
</ul>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="machine-learning-defined" class="slide level2">
<h2>Machine learning defined</h2>
<p>There are many ways to define Machine Learning. Here’s a good working definition: <img data-src="images/ML_defined_by_MS.png"></p>
<div class="footer">
<p>Source: <a href="https://azure.microsoft.com/en-us/resources/cloud-computing-dictionary/what-is-machine-learning-platform/" class="uri">https://azure.microsoft.com/en-us/resources/cloud-computing-dictionary/what-is-machine-learning-platform/</a></p>
</div>
<aside class="notes">
<ul>
<li>ML uses mathematical models to learn patterns without explicitly telling it how to learn.</li>
<li>It learns from experience</li>
<li>More data –&gt; more experience – &gt; more likely that it will learn the patterns</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="ml-vs-statistics" class="slide level2">
<h2>ML vs Statistics</h2>
<p><img data-src="images/ML_vs_stats.png"></p>
<div class="footer">
<p>Source: <a href="https://towardsdatascience.com/how-is-machine-learning-different-from-statistics-and-why-it-matters-5a8ed539976" class="uri">https://towardsdatascience.com/how-is-machine-learning-different-from-statistics-and-why-it-matters-5a8ed539976</a></p>
</div>
<aside class="notes">
<ul>
<li>Using numerical optimization instead of an assumed data generating process (Normal iid, etc)</li>
<li>More emphasis on predictive accuracy, less on inference</li>
<li>ML models don’t lean on distributional assumptions. They require more data to learn the patterns</li>
<li>In statistical inference, we might care more about whether certain parameters are significant, and whether the our model assumptions are reasonable via Goodness of fit test. In ML, we care more about whether the model predictions are accurate.</li>
<li>ML models are less interpretable</li>
<li>R is the preferred tool for statisticians, whereas Python is the preferred tool for data scientists. However, the lines are blurring these days, so that is quite possible to do both stats and ML in both.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="healthcare-applications" class="slide level2">
<h2>Healthcare applications</h2>
<p><img data-src="images/ML_healthcare.jpeg"></p>
<div class="footer">
<p>Source: <a href="https://www.botreetechnologies.com/blog/machine-learning-in-healthcare/" class="uri">https://www.botreetechnologies.com/blog/machine-learning-in-healthcare/</a></p>
</div>
<aside class="notes">
<ul>
<li>Lots of uses for ML in healthcare</li>
<li>On Day 1 of the workshop, Haoda Fu in AADS mentioned the computer vision and</li>
<li>Yushi Liu in Discovery also talked about how he used ML for target identification</li>
<li>As you can see, there are lots of other applications that can help with operations, such as patient flow optimization and detecting process inefficiencies.</li>
<li>In the pre-clinical space, it could help with risk stratification, say for example if you wanted to identify high risk patients that could potentially get the most benefit from your molecule.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="ml-benefits-opportunities" class="slide level2">
<h2>ML Benefits / Opportunities</h2>
<ul>
<li><p>All the cool kids are doing it 😎</p></li>
<li><p>Can often yield more accurate predictions</p></li>
<li><p>Automatically learns interactive relationships between predictors and outcomes</p>
<ul>
<li>Less of a need to manually code interactions</li>
</ul></li>
<li><p>Many approaches inherently include variable selection</p></li>
<li><p>Requires fewer assumptions than statistical models</p>
<ul>
<li><p>Independent variables</p></li>
<li><p>Independent training examples</p></li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>AI/ML is the buzz word of the day, so everyone wants to be one of the folks who say they are doing AI/ML</li>
<li>The model predictions can be more accurate compared to some of the statistical modeling approaches</li>
<li>You wouldn’t have to manually code interactions. It automatically learns how the predictors work together</li>
<li>The models usually help you understand which variables are most important in predicting the outcome</li>
<li>We don’t lean on the types of assumptions that are used in traditional statistical models, for example, independent predictor variables or independent records (rows)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="ml-challenges" class="slide level2">
<h2>ML Challenges</h2>
<ul>
<li><p>Requires larger datasets</p></li>
<li><p>Garbage in --&gt; Garbage out</p>
<ul>
<li>Can learn and re-enforce biases inherent in data</li>
</ul></li>
<li><p>Must take care to avoid overfitting</p></li>
<li><p>Can take more time or computational resources to train the model</p></li>
<li><p>Steep learning curve for some</p></li>
<li><p>Must tune hyperparameters to get the best fit</p>
<ul>
<li>Automated ML can help with this (somewhat)</li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>As stated in previous slids, ML algorithms tend to require larger datasets</li>
<li>If the data contain biases, then it can pick up on those patterns and perpetuate those biases… so we have to be careful about this.</li>
<li>Can learn patterns in the training data that don’t generalize well to other data (overfitting)</li>
<li>We are used to fitting a statistical model in a matter of seconds. However, some ML models can take several minutes to train (or hours, in extreme cases depending model complexity). May need to use more computational resources such as (1) multiple cores on a laptop (2) a high performance computing cluster or (3) a GPU.</li>
<li>May take a bit more time for some to learn the approach and feel comfortable applying these on real problems. However, hopefully after Days 2 and 3 of the workshop you will have a head start!</li>
<li>An algorithm’s performance heavily depends on the values of the parameter values. We need to try lots of combinations of parameter values in order to find the optimal combination that will give the best fit. There are automated parameter search algorithms that can help with this.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="ml-types" class="slide level2">
<h2>ML types</h2>
<p><img data-src="images/ML_types.png"></p>
<div class="footer">
<p>Source: <a href="https://litslink.com/blog/an-introduction-to-machine-learning-algorithms" class="uri">https://litslink.com/blog/an-introduction-to-machine-learning-algorithms</a></p>
</div>
<aside class="notes">
<ul>
<li>Three large classes of ML: supervised learning, unsupervised learning, semi-supervised learning, and reinforcement learning</li>
<li>Supervised means we have labeled data. We know “the answer” (the true value of the outcome), so we can assess how well the model correctly predicts the outcome.
<ul>
<li>Regression - predict a continuous outcome such as housing prices</li>
<li>Classification - decide which class an item or person belongs to. In medical imaging, we might want to decide whether the radiation image shows a tumor or no tumor.</li>
</ul></li>
<li>Unsupervised means we don’t have any labels, so there is no right or wrong answer that we want to predict. We want the algorithm to reveal patterns in the data, such as how units are grouped together, or how they are associated with one another.</li>
<li>Supervised and unsupervised learning are the most popular two types that you will encounter. The other two are beyond the scope of this lecture, but I can discuss these in a future workshop if there’s interest.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="supervised-learning-ml-algorithms" class="slide level2">
<h2>Supervised Learning ML algorithms</h2>
<ul>
<li><p>Decision tree</p></li>
<li><p>Random forest</p></li>
<li><p>XGBoost</p></li>
<li><p>K Nearest Neighbors</p></li>
<li><p>Many more!</p></li>
</ul>
<aside class="notes">
<ul>
<li>I’ve listed several of the more popular types of ML algorithms for supervised learning ML</li>
<li>They are quite different in how they are implemented, have various strengths/weaknesses.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="unsupervised-learning-ml-algorithms" class="slide level2">
<h2>Unsupervised learning ML algorithms</h2>
<ul>
<li><p>K-means</p></li>
<li><p>K-protoypes</p></li>
<li><p>K Nearest Neighbors</p></li>
<li><p>Many more!</p></li>
</ul>
<aside class="notes">
<ul>
<li>These are a few popular unsupervised learning ML algorithms.</li>
<li>Probably not productive for us to go into the details of how each algorithm works in this session, so we can also host a future deep dive into the various algorithms in a future session if you all are interested.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="tools" class="title-slide slide level1 center">
<h1>Tools</h1>

</section>
<section id="integrated-development-environments-ides" class="slide level2">
<h2>Integrated development environments (IDEs)</h2>
<ul>
<li><p>RStudio</p>
<ul>
<li><p>RStudio Server</p></li>
<li><p>RStudio Desktop</p></li>
<li><p>RStudio on Linux remote desktop</p></li>
</ul></li>
<li><p>JupyterHub</p></li>
</ul>
<aside class="notes">
<ul>
<li>You might choose to use an IDE, or integrated development environment to do your ML modeling</li>
<li>These provide a framework for loading your R projects or python virtual environments, doing your exploratory data analysis, building your models, deploying your models, etc</li>
<li>RStudio works with both R and Python</li>
<li>JupyterHub works with both R and Python</li>
<li>Since the workshop is primarily aimed at statisticians in SDnA / GSS, and they mostly use R, I chose to demonstrate an R-based modeling demo for the workshop.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="data-munging-eda" class="slide level2">
<h2>Data munging &amp; EDA</h2>
<p>These packages are used for data manipulation and exploratory data analysis</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">R</th>
<th style="text-align: center;">Python</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>tidyverse</code></td>
<td style="text-align: center;"><code>pandas</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>ggplot2</code></td>
<td style="text-align: center;"><code>matplotlib</code>, <code>seaborn</code></td>
</tr>
</tbody>
</table>
<aside class="notes">
<ul>
<li>R packages and python modules that are commonly used for data manipulation and exploratory data analysis</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="model-development" class="slide level2">
<h2>Model development</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">R</th>
<th style="text-align: center;">Python</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>tidymodels</code></td>
<td style="text-align: center;"><code>sklearn</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>h2o</code></td>
<td style="text-align: center;"><code>h2o</code></td>
</tr>
</tbody>
</table>
<aside class="notes">
<ul>
<li>R packages and python modules that are commonly used for ML model development</li>
<li>I reallly like the h2o modeling framework. Works with both R and python. Has a nice interface (command line + GUI). Lots of great utilities for model assessment and model deployment. It was my go-to ML framework prior to the tidymodels launch.</li>
<li>Tidymodels was developed more recently by the RStudio team. Max Kuhn is one of the authors. It is becoming more popular as they add new features and expand the user base. I find it to be well-developed. It is very intuitive and easy to learn. I highly recommend it.</li>
<li>We will use the tidymodels framework for the workshop.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="ml-best-practices" class="title-slide slide level1 center">
<h1>ML best practices</h1>

</section>
<section id="ml-best-practices-1" class="slide level2">
<h2>10 ML best practices</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ol type="1">
<li><p>Define modeling objectives</p></li>
<li><p>Exploratory data analysis</p></li>
<li><p>Feature engineering</p></li>
<li><p>Feature selection</p></li>
<li><p>Split data into training / testing sets</p></li>
</ol>
</div><div class="column" style="width:50%;">
<ol start="6" type="1">
<li><p>Train / validate the model</p></li>
<li><p>Create visual summaries</p></li>
<li><p>Explain the model predictions</p></li>
<li><p>Deploy the model</p></li>
<li><p>Create a ML workflow</p></li>
</ol>
</div>
</div>
<aside class="notes">
<ul>
<li>As I reflected on the machine learning projects that I’ve worked on over the years, I came up with a list of 10 best practices for model development.</li>
<li>This isn’t to suggest that these are to be performed in this particular order.</li>
<li>You may end up doing and re-doing some or all of these steps multiple times as the project progresses.</li>
<li>We will spend the rest of the workshop diving into each of these principles</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="define-modeling-objectives" class="title-slide slide level1 center">
<h1>1. Define modeling objectives</h1>

</section>
<section id="define-modeling-objectives-1" class="slide level2">
<h2>1. Define modeling objectives</h2>
<ul>
<li><p>What do we want the model to do?</p>
<ul>
<li>Classification? Regression? Clustering?</li>
</ul></li>
<li><p>What is the outcome / target variable (if any)?</p></li>
<li><p>Identify the relevant data sources</p></li>
<li><p>Select appropriate ML algorithm(s) that align with the modeling objective</p></li>
</ul>
<aside class="notes">
<ul>
<li>As in a statistical analysis, we should start with a plan.</li>
<li>What do we want the model to do… classification? Regression?</li>
<li>If it’s a supervised learning project, what is the outcome that we want to predict?</li>
<li>Which data sources are we going to leverage?</li>
<li>Which ML algorithms do we want to try?</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-clinical-trial-actg-175" class="slide level2">
<h2>1. Example: Clinical Trial ACTG 175</h2>
<ul>
<li><p>ACTG 175 was a randomized, double-blind, placebo-controlled trial that included HIV-1–infected subjects with CD4 cell counts 200-500 per cubic mm</p></li>
<li><p>Treatments</p>
<ul>
<li>Monotherapy: (1) zidovudine alone or (2) didanosine alone</li>
<li>Combination therapy: (3) zidovudine + didanosine or (4) zidovudine + zalcitabine</li>
</ul></li>
<li><p>Primary study end point: (1) &gt;50% decline in CD4 cell count, (2) progression to AIDS, or (3) death.</p></li>
</ul>
</section>
<section id="example-modeling-plan" class="slide level2">
<h2>1. Example: Modeling Plan</h2>
<ul>
<li><p>Objective: Given baseline characteristics, predict whether patient will experience the primary study endpoint within the observation period</p></li>
<li><p>Outcome: Binary indicator of whether patient had &gt;50% CD4+ increase, progressed to AIDS, or death</p></li>
<li><p>Data source: Clinical data – baseline predictors, treatment assignment, study outcomes</p></li>
<li><p>Candidate algorithms</p>
<ul>
<li>Supervised learning / binary classification: Random forest, XGBoost, &amp; Logistic regression</li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>Try two ML approaches: random forest and xgboost</li>
<li>Compare to a simple logistic regression as a benchmark.</li>
<li>Do this problem really need a ML solution? Do we see any benefit beyond what we would get from a simpler model?</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="exploratory-data-analysis" class="title-slide slide level1 center">
<h1>2. Exploratory data analysis</h1>

</section>
<section id="exploratory-data-analysis-1" class="slide level2">
<h2>2. Exploratory data analysis</h2>
<ul>
<li><p>Data quality</p></li>
<li><p>Missing data summary / investigation</p></li>
<li><p>Determine if we need to exclude any data points or variables</p></li>
<li><p>Determine if we need to transform any variables</p></li>
<li><p>Examine relationships between candidate predictors and outcomes</p></li>
</ul>
</section>
<section id="example-environment-setup" class="slide level2">
<h2>2. Example: Environment setup</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Load Packages</a></li><li><a href="#tabset-1-2">Load Helper Fns</a></li><li><a href="#tabset-1-3">Load Data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="in">```{r load_pkg}</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Load the packages</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(speff2trial))</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(testthat))</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidymodels))</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(yardstick))</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(DT))</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(pROC))</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(recipes))</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(themis))</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(DALEXtra))</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1"></a><span class="in">```{r load_helpers}</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Helper function: Pretty data table</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># Table fmt ref: https://stackoverflow.com/questions/44368572/dt-showing-more-rows-in-dt</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>pretty_dt <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, <span class="at">num_digits =</span> <span class="dv">3</span>, <span class="at">num_rows=</span><span class="dv">20</span>) {</span>
<span id="cb2-7"><a href="#cb2-7"></a>  dt <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="fu">head</span>(num_rows) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="fu">datatable</span>(</span>
<span id="cb2-10"><a href="#cb2-10"></a>      <span class="at">fillContainer =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-11"><a href="#cb2-11"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">5</span>, </span>
<span id="cb2-12"><a href="#cb2-12"></a>                     <span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13"></a>                     <span class="at">dom =</span> <span class="st">'tip'</span>, <span class="co"># table only</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>                     <span class="at">scrollX =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-15"><a href="#cb2-15"></a>                     <span class="at">scrollY =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>                     <span class="at">initComplete =</span> <span class="fu">JS</span>(</span>
<span id="cb2-17"><a href="#cb2-17"></a>                            <span class="st">"function(settings, json) {"</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>                            <span class="st">"$(this.api().table().header()).css({'color': 'white'});"</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>                            <span class="st">"}"</span>)</span>
<span id="cb2-20"><a href="#cb2-20"></a>        )</span>
<span id="cb2-21"><a href="#cb2-21"></a>      )</span>
<span id="cb2-22"><a href="#cb2-22"></a>  </span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="co"># Round float columns (numeric but not integer)</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>  cols_numeric <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tbl)[<span class="fu">sapply</span>(tbl, is.numeric)]</span>
<span id="cb2-25"><a href="#cb2-25"></a>  cols_integer <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tbl)[<span class="fu">sapply</span>(tbl, is.integer)]</span>
<span id="cb2-26"><a href="#cb2-26"></a>  cols_float <span class="ot">&lt;-</span> cols_numeric[<span class="sc">!</span>(cols_numeric <span class="sc">%in%</span> cols_integer)]</span>
<span id="cb2-27"><a href="#cb2-27"></a>  <span class="cf">if</span> (<span class="fu">length</span>(cols_float) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-28"><a href="#cb2-28"></a>    dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">formatRound</span>(cols_float, num_digits)</span>
<span id="cb2-29"><a href="#cb2-29"></a>  }</span>
<span id="cb2-30"><a href="#cb2-30"></a>  </span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb2-32"><a href="#cb2-32"></a>}</span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1"></a><span class="in">```{r load_data}</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># Load the data</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">data</span>(ACTG175)</span>
<span id="cb3-4"><a href="#cb3-4"></a>dat_raw <span class="ot">&lt;-</span> ACTG175</span>
<span id="cb3-5"><a href="#cb3-5"></a>dat_raw <span class="sc">%&gt;%</span> summary</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     pidnum            age             wtkg             hemo        
 Min.   : 10056   Min.   :12.00   Min.   : 31.00   Min.   :0.00000  
 1st Qu.: 81446   1st Qu.:29.00   1st Qu.: 66.68   1st Qu.:0.00000  
 Median :190566   Median :34.00   Median : 74.39   Median :0.00000  
 Mean   :248778   Mean   :35.25   Mean   : 75.13   Mean   :0.08415  
 3rd Qu.:280277   3rd Qu.:40.00   3rd Qu.: 82.56   3rd Qu.:0.00000  
 Max.   :990077   Max.   :70.00   Max.   :159.94   Max.   :1.00000  
                                                                    
      homo            drugs            karnof           oprior       
 Min.   :0.0000   Min.   :0.0000   Min.   : 70.00   Min.   :0.00000  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.: 90.00   1st Qu.:0.00000  
 Median :1.0000   Median :0.0000   Median :100.00   Median :0.00000  
 Mean   :0.6611   Mean   :0.1314   Mean   : 95.45   Mean   :0.02197  
 3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:100.00   3rd Qu.:0.00000  
 Max.   :1.0000   Max.   :1.0000   Max.   :100.00   Max.   :1.00000  
                                                                     
      z30             zprior     preanti            race            gender     
 Min.   :0.0000   Min.   :1   Min.   :   0.0   Min.   :0.0000   Min.   :0.000  
 1st Qu.:0.0000   1st Qu.:1   1st Qu.:   0.0   1st Qu.:0.0000   1st Qu.:1.000  
 Median :1.0000   Median :1   Median : 142.0   Median :0.0000   Median :1.000  
 Mean   :0.5503   Mean   :1   Mean   : 379.2   Mean   :0.2885   Mean   :0.828  
 3rd Qu.:1.0000   3rd Qu.:1   3rd Qu.: 739.5   3rd Qu.:1.0000   3rd Qu.:1.000  
 Max.   :1.0000   Max.   :1   Max.   :2851.0   Max.   :1.0000   Max.   :1.000  
                                                                               
      str2            strat         symptom          treat       
 Min.   :0.0000   Min.   :1.00   Min.   :0.000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:1.00   1st Qu.:0.000   1st Qu.:1.0000  
 Median :1.0000   Median :2.00   Median :0.000   Median :1.0000  
 Mean   :0.5858   Mean   :1.98   Mean   :0.173   Mean   :0.7513  
 3rd Qu.:1.0000   3rd Qu.:3.00   3rd Qu.:0.000   3rd Qu.:1.0000  
 Max.   :1.0000   Max.   :3.00   Max.   :1.000   Max.   :1.0000  
                                                                 
     offtrt            cd40            cd420            cd496       
 Min.   :0.0000   Min.   :   0.0   Min.   :  49.0   Min.   :   0.0  
 1st Qu.:0.0000   1st Qu.: 263.5   1st Qu.: 269.0   1st Qu.: 209.2  
 Median :0.0000   Median : 340.0   Median : 353.0   Median : 321.0  
 Mean   :0.3628   Mean   : 350.5   Mean   : 371.3   Mean   : 328.6  
 3rd Qu.:1.0000   3rd Qu.: 423.0   3rd Qu.: 460.0   3rd Qu.: 440.0  
 Max.   :1.0000   Max.   :1199.0   Max.   :1119.0   Max.   :1190.0  
                                                    NA's   :797     
       r               cd80            cd820             cens       
 Min.   :0.0000   Min.   :  40.0   Min.   : 124.0   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.: 654.0   1st Qu.: 631.5   1st Qu.:0.0000  
 Median :1.0000   Median : 893.0   Median : 865.0   Median :0.0000  
 Mean   :0.6274   Mean   : 986.6   Mean   : 935.4   Mean   :0.2436  
 3rd Qu.:1.0000   3rd Qu.:1207.0   3rd Qu.:1146.5   3rd Qu.:0.0000  
 Max.   :1.0000   Max.   :5011.0   Max.   :6035.0   Max.   :1.0000  
                                                                    
      days             arms      
 Min.   :  14.0   Min.   :0.000  
 1st Qu.: 727.0   1st Qu.:1.000  
 Median : 997.0   Median :2.000  
 Mean   : 879.1   Mean   :1.521  
 3rd Qu.:1091.0   3rd Qu.:3.000  
 Max.   :1231.0   Max.   :3.000  
                                 </code></pre>
</div>
</div>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>To start, we set up the environment. Load packages and a helper function that makes it easier to display tables in the slides.</li>
<li>Clinical data for the ACTG 175 trial comes from the <code>speff2trial</code> R package</li>
<li>The help page for this dataset includes a data dictionary that shows how the data are coded. It would be helpful to transform the data using these suggested codings.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-data-transformations" class="slide level2">
<h2>2. Example: Data transformations</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>dat_clean <span class="ot">&lt;-</span> dat_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">mutate</span>(<span class="at">treatment_arm =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    arms <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'zidovudine'</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    arms <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'zidovudine and didanosine'</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    arms <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">'zidovudine and zalcitabine'</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    arms <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'didanosine'</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="at">hemo =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-11"><a href="#cb5-11"></a>      hemo <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>      hemo <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-13"><a href="#cb5-13"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>    ),</span>
<span id="cb5-15"><a href="#cb5-15"></a>    <span class="at">lgbtq =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-16"><a href="#cb5-16"></a>      homo <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-17"><a href="#cb5-17"></a>      homo <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-18"><a href="#cb5-18"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>    ),</span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="at">hist_intra_drug_use =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-21"><a href="#cb5-21"></a>      drugs <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-22"><a href="#cb5-22"></a>      drugs <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-23"><a href="#cb5-23"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>    ),</span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="at">prior_nz_art =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-26"><a href="#cb5-26"></a>      oprior <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-27"><a href="#cb5-27"></a>      oprior <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-28"><a href="#cb5-28"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-29"><a href="#cb5-29"></a>    ),</span>
<span id="cb5-30"><a href="#cb5-30"></a>    <span class="at">prior_z_30days =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-31"><a href="#cb5-31"></a>      z30 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-32"><a href="#cb5-32"></a>      z30 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>    ),</span>
<span id="cb5-35"><a href="#cb5-35"></a>    <span class="at">prior_z =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-36"><a href="#cb5-36"></a>      zprior <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-37"><a href="#cb5-37"></a>      zprior <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-38"><a href="#cb5-38"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-39"><a href="#cb5-39"></a>    ),</span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span class="at">days_prior_art =</span> preanti,</span>
<span id="cb5-41"><a href="#cb5-41"></a>    <span class="at">race =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-42"><a href="#cb5-42"></a>      race <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'white'</span>,</span>
<span id="cb5-43"><a href="#cb5-43"></a>      race <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'non-white'</span>,</span>
<span id="cb5-44"><a href="#cb5-44"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-45"><a href="#cb5-45"></a>    ),</span>
<span id="cb5-46"><a href="#cb5-46"></a>    <span class="at">gender =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-47"><a href="#cb5-47"></a>      gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'female'</span>,</span>
<span id="cb5-48"><a href="#cb5-48"></a>      gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'male'</span>,</span>
<span id="cb5-49"><a href="#cb5-49"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-50"><a href="#cb5-50"></a>    ),</span>
<span id="cb5-51"><a href="#cb5-51"></a>    <span class="at">prior_art =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-52"><a href="#cb5-52"></a>      str2 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'naive'</span>,</span>
<span id="cb5-53"><a href="#cb5-53"></a>      str2 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'experienced'</span>,</span>
<span id="cb5-54"><a href="#cb5-54"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-55"><a href="#cb5-55"></a>    ),</span>
<span id="cb5-56"><a href="#cb5-56"></a>    <span class="at">strat_hist_art =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-57"><a href="#cb5-57"></a>      strat <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'antiretroviral naive'</span>,</span>
<span id="cb5-58"><a href="#cb5-58"></a>      strat <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">'&gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy'</span>,</span>
<span id="cb5-59"><a href="#cb5-59"></a>      strat <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'&gt; 52 weeks'</span>,</span>
<span id="cb5-60"><a href="#cb5-60"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>    ),</span>
<span id="cb5-62"><a href="#cb5-62"></a>    <span class="at">symptom =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-63"><a href="#cb5-63"></a>      symptom <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'asymptomatic'</span>,</span>
<span id="cb5-64"><a href="#cb5-64"></a>      symptom <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'symptomatic'</span>,</span>
<span id="cb5-65"><a href="#cb5-65"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-66"><a href="#cb5-66"></a>    ),</span>
<span id="cb5-67"><a href="#cb5-67"></a>    <span class="at">prior_z =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-68"><a href="#cb5-68"></a>      zprior <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-69"><a href="#cb5-69"></a>      zprior <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-70"><a href="#cb5-70"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-71"><a href="#cb5-71"></a>    ),</span>
<span id="cb5-72"><a href="#cb5-72"></a>    <span class="at">prior_z =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-73"><a href="#cb5-73"></a>      zprior <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no'</span>,</span>
<span id="cb5-74"><a href="#cb5-74"></a>      zprior <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'yes'</span>,</span>
<span id="cb5-75"><a href="#cb5-75"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb5-76"><a href="#cb5-76"></a>    ),</span>
<span id="cb5-77"><a href="#cb5-77"></a>    <span class="at">zidovudine_indicator =</span> treat,</span>
<span id="cb5-78"><a href="#cb5-78"></a>    <span class="at">surv_days =</span> days,</span>
<span id="cb5-79"><a href="#cb5-79"></a>    <span class="at">surv_event =</span> cens,</span>
<span id="cb5-80"><a href="#cb5-80"></a>    <span class="at">event =</span> <span class="fu">ifelse</span>(surv_event <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'no'</span>, <span class="st">'yes'</span>) <span class="sc">%&gt;%</span> factor,</span>
<span id="cb5-81"><a href="#cb5-81"></a>    <span class="at">baseline_cd4 =</span> cd40,</span>
<span id="cb5-82"><a href="#cb5-82"></a>    <span class="at">baseline_cd8 =</span> cd80</span>
<span id="cb5-83"><a href="#cb5-83"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-84"><a href="#cb5-84"></a>  <span class="fu">select</span>(</span>
<span id="cb5-85"><a href="#cb5-85"></a>    <span class="co"># identifier</span></span>
<span id="cb5-86"><a href="#cb5-86"></a>    pidnum, </span>
<span id="cb5-87"><a href="#cb5-87"></a>    <span class="co"># treatment assignment </span></span>
<span id="cb5-88"><a href="#cb5-88"></a>   zidovudine_indicator, treatment_arm, offtrt, </span>
<span id="cb5-89"><a href="#cb5-89"></a>    <span class="co"># baseline predictors</span></span>
<span id="cb5-90"><a href="#cb5-90"></a>    age, wtkg, hemo, lgbtq, hist_intra_drug_use, karnof, prior_nz_art, prior_z_30days, prior_z, days_prior_art, race, gender, prior_art, strat_hist_art, symptom, baseline_cd4, baseline_cd8, </span>
<span id="cb5-91"><a href="#cb5-91"></a>   <span class="co"># survival outcome</span></span>
<span id="cb5-92"><a href="#cb5-92"></a>   event, surv_event, surv_days,</span>
<span id="cb5-93"><a href="#cb5-93"></a>   <span class="co"># other outcomes</span></span>
<span id="cb5-94"><a href="#cb5-94"></a>   cd420, cd496, r, cd820</span>
<span id="cb5-95"><a href="#cb5-95"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-96"><a href="#cb5-96"></a>  <span class="fu">mutate_if</span>(is.character, factor) </span>
<span id="cb5-97"><a href="#cb5-97"></a></span>
<span id="cb5-98"><a href="#cb5-98"></a>dat_clean <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     pidnum       zidovudine_indicator                    treatment_arm
 Min.   : 10056   Min.   :0.0000       didanosine                :561  
 1st Qu.: 81446   1st Qu.:1.0000       zidovudine                :532  
 Median :190566   Median :1.0000       zidovudine and didanosine :522  
 Mean   :248778   Mean   :0.7513       zidovudine and zalcitabine:524  
 3rd Qu.:280277   3rd Qu.:1.0000                                       
 Max.   :990077   Max.   :1.0000                                       
                                                                       
     offtrt            age             wtkg         hemo      lgbtq     
 Min.   :0.0000   Min.   :12.00   Min.   : 31.00   no :1959   no : 725  
 1st Qu.:0.0000   1st Qu.:29.00   1st Qu.: 66.68   yes: 180   yes:1414  
 Median :0.0000   Median :34.00   Median : 74.39                        
 Mean   :0.3628   Mean   :35.25   Mean   : 75.13                        
 3rd Qu.:1.0000   3rd Qu.:40.00   3rd Qu.: 82.56                        
 Max.   :1.0000   Max.   :70.00   Max.   :159.94                        
                                                                        
 hist_intra_drug_use     karnof       prior_nz_art prior_z_30days prior_z   
 no :1858            Min.   : 70.00   no :2092     no : 962       yes:2139  
 yes: 281            1st Qu.: 90.00   yes:  47     yes:1177                 
                     Median :100.00                                         
                     Mean   : 95.45                                         
                     3rd Qu.:100.00                                         
                     Max.   :100.00                                         
                                                                            
 days_prior_art          race         gender           prior_art   
 Min.   :   0.0   non-white: 617   female: 368   experienced:1253  
 1st Qu.:   0.0   white    :1522   male  :1771   naive      : 886  
 Median : 142.0                                                    
 Mean   : 379.2                                                    
 3rd Qu.: 739.5                                                    
 Max.   :2851.0                                                    
                                                                   
                                             strat_hist_art         symptom    
 &gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy:410    asymptomatic:1769  
 &gt; 52 weeks                                         :843    symptomatic : 370  
 antiretroviral naive                               :886                       
                                                                               
                                                                               
                                                                               
                                                                               
  baseline_cd4     baseline_cd8    event        surv_event       surv_days     
 Min.   :   0.0   Min.   :  40.0   no :1618   Min.   :0.0000   Min.   :  14.0  
 1st Qu.: 263.5   1st Qu.: 654.0   yes: 521   1st Qu.:0.0000   1st Qu.: 727.0  
 Median : 340.0   Median : 893.0              Median :0.0000   Median : 997.0  
 Mean   : 350.5   Mean   : 986.6              Mean   :0.2436   Mean   : 879.1  
 3rd Qu.: 423.0   3rd Qu.:1207.0              3rd Qu.:0.0000   3rd Qu.:1091.0  
 Max.   :1199.0   Max.   :5011.0              Max.   :1.0000   Max.   :1231.0  
                                                                               
     cd420            cd496              r              cd820       
 Min.   :  49.0   Min.   :   0.0   Min.   :0.0000   Min.   : 124.0  
 1st Qu.: 269.0   1st Qu.: 209.2   1st Qu.:0.0000   1st Qu.: 631.5  
 Median : 353.0   Median : 321.0   Median :1.0000   Median : 865.0  
 Mean   : 371.3   Mean   : 328.6   Mean   :0.6274   Mean   : 935.4  
 3rd Qu.: 460.0   3rd Qu.: 440.0   3rd Qu.:1.0000   3rd Qu.:1146.5  
 Max.   :1119.0   Max.   :1190.0   Max.   :1.0000   Max.   :6035.0  
                  NA's   :797                                       </code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>Used the data dictionary to recode the categorical variables into meaningful labels</li>
<li>Changed some variable names</li>
<li>Selected only the relevant columns that I might want to use as predictors or outcomes</li>
<li>Represented character fields as factor</li>
<li>The data summary is easier to read after applying transformations</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-data-preview" class="slide level2">
<h2>2. Example: Data preview</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>dat_clean <span class="sc">%&gt;%</span> pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-508c3e849c06caaf44cd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-508c3e849c06caaf44cd">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[10056,10059,10089,10093,10124,10140,10165,10190,10198,10229,10241,10341,10343,10361,10364,10368,10378,10386,10389,10432],[1,1,1,1,0,1,0,0,1,0,1,1,1,1,1,0,0,1,1,1],["zidovudine and zalcitabine","didanosine","didanosine","didanosine","zidovudine","zidovudine and didanosine","zidovudine","zidovudine","didanosine","zidovudine","zidovudine and zalcitabine","didanosine","zidovudine and zalcitabine","zidovudine and didanosine","zidovudine and zalcitabine","zidovudine","zidovudine","zidovudine and zalcitabine","zidovudine and didanosine","zidovudine and zalcitabine"],[0,0,1,0,0,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0],[48,61,45,47,43,46,31,41,40,35,34,38,25,34,49,40,27,46,47,34],[89.8128,49.4424,88.452,85.2768,66.6792,88.9056,73.0296,66.2256,82.5552,78.0192,95.256,76.4316,68.04,62.8236,79.38,83.0088,67.3,63.8,94,60.3288],["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"],["no","no","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","no","yes","yes","no"],["no","no","yes","no","no","yes","no","yes","no","no","no","no","no","no","no","no","yes","no","no","no"],[100,90,90,100,100,100,100,100,90,100,100,100,90,90,90,100,90,100,100,100],["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"],["no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes"],["yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes"],[0,895,707,1399,1352,1181,930,1329,1074,964,897,461,852,342,402,974,875,881,1421,854],["white","white","white","white","white","white","white","white","white","white","non-white","white","white","white","white","white","white","white","white","non-white"],["female","female","male","male","male","male","male","male","male","male","female","male","male","male","male","male","female","male","male","female"],["naive","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced","experienced"],["antiretroviral naive","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks"],["asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","symptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","symptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic"],[422,162,326,287,504,235,244,401,214,221,471,340,540,212,120,150,350,330,180,233],[566,392,2063,1590,870,860,708,889,652,221,770,660,1590,1094,800,1730,750,820,710,1462],["no","yes","no","no","no","no","yes","no","yes","yes","yes","no","no","no","yes","yes","no","no","yes","no"],[0,1,0,0,0,0,1,0,1,1,1,0,0,0,1,1,0,0,1,0],[948,1002,961,1166,1090,1181,794,957,198,188,1073,1175,1203,1065,357,308,1062,1069,322,1119],[477,218,274,394,353,339,225,366,107,132,468,230,590,190,140,90,440,320,200,240],[660,null,122,null,660,264,106,453,8,null,477,270,410,100,null,20,null,180,null,null],[1,0,1,0,1,1,1,1,1,0,1,1,1,1,0,1,0,1,0,0],[324,564,1893,966,782,1060,699,720,131,759,620,510,1330,1180,1090,1160,990,630,830,1170]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>pidnum<\/th>\n      <th>zidovudine_indicator<\/th>\n      <th>treatment_arm<\/th>\n      <th>offtrt<\/th>\n      <th>age<\/th>\n      <th>wtkg<\/th>\n      <th>hemo<\/th>\n      <th>lgbtq<\/th>\n      <th>hist_intra_drug_use<\/th>\n      <th>karnof<\/th>\n      <th>prior_nz_art<\/th>\n      <th>prior_z_30days<\/th>\n      <th>prior_z<\/th>\n      <th>days_prior_art<\/th>\n      <th>race<\/th>\n      <th>gender<\/th>\n      <th>prior_art<\/th>\n      <th>strat_hist_art<\/th>\n      <th>symptom<\/th>\n      <th>baseline_cd4<\/th>\n      <th>baseline_cd8<\/th>\n      <th>event<\/th>\n      <th>surv_event<\/th>\n      <th>surv_days<\/th>\n      <th>cd420<\/th>\n      <th>cd496<\/th>\n      <th>r<\/th>\n      <th>cd820<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,4,5,6,10,14,20,21,23,24,25,26,27,28]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>Showing the first few rows of the transformed data table</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-data-visualizations" class="slide level2">
<h2>2. Example: Data visualizations</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Plots 1 - 2</a></li><li><a href="#tabset-2-2">Plots 3 - 4</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Specify variable types</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>var_outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'event'</span>, <span class="st">'surv_event'</span>, <span class="st">'surv_days'</span>, <span class="st">'cd420'</span>, <span class="st">'cd496'</span>, <span class="st">'r'</span>, <span class="st">'cd820'</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>excluded_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'pidnum'</span>, <span class="st">'zidovudine_indicator'</span>, <span class="st">'offtrt'</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dat_clean, class)</span>
<span id="cb8-5"><a href="#cb8-5"></a>vars_factor <span class="ot">&lt;-</span> classes[classes <span class="sc">==</span> <span class="st">'factor'</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6"></a>  names <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7"></a>  .[<span class="sc">!</span>(. <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'progression'</span>, <span class="st">'event'</span>))]</span>
<span id="cb8-8"><a href="#cb8-8"></a>vars_cont <span class="ot">&lt;-</span> classes[(classes  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'integer'</span>, <span class="st">'numeric'</span>))] <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9"></a>  names <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10"></a>  .[<span class="sc">!</span>(. <span class="sc">%in%</span> <span class="fu">c</span>(var_outcomes, excluded_cols))]</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co"># Bar plot of event counts</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="fu">count</span>(event) <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> event, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>) <span class="sc">+</span> </span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Patient counts by event status'</span>)</span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co"># Boxplot of baseline CD4 levels across treatment arms</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment_arm, <span class="at">y =</span> baseline_cd4)) <span class="sc">+</span> </span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="fu">xlab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Baseline CD4'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/data-data_viz_p12-1.png" width="960"></p>
<p></p><figcaption>Event distribution is skewed</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/data-data_viz_p12-2.png" width="960"></p>
<p></p><figcaption>Baseline CD4 levels extend beyond the 200-500 range</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Bar plot of prior_z counts</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">count</span>(prior_z) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prior_z, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">xlab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Patient counts by prior zidovudine history'</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># Bar plot of prior_nz_art counts</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">count</span>(prior_nz_art) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prior_nz_art, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="fu">xlab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Patient counts by prior non-zidovudine history'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/data_viz_p34-1.png" width="960"></p>
<p></p><figcaption>All patients have had prior zidovudine therapy</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/data_viz_p34-2.png" width="960"></p>
<p></p><figcaption>Few patients have had prior non-zidovudine therapy</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>As in any other data analysis, it is helpful to prepare summary plots that show distributions and trends in the data.</li>
<li>The event distribution is skewed. The event only occurs in about 25% of the patients. We will come back to this point.</li>
<li>Inclusion criteria in the paper says the study included patients with CD4 cell count values ranging from 200-500 per cubic mm. However, the baseline CD4 ranges extend beyond that range in all treatment arms. There is even a patient who appears to have a baseline CD4 of zero. This could either mean that we have data quality issues, and/or that some patients may have had significant shifts in their CD4 values since they were initially assessed.</li>
<li>All of the patients have the same value in the prior zidovudine variable. This suggests that all patients had zidovudine treatment in the past.</li>
<li>We also see that only a few patients had no prior non-zidovudine treatment in the past. There is very little variation in these variables, so they probably won’t be useful as predictor variables in a model.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="feature-engineering" class="title-slide slide level1 center">
<h1>3. Feature engineering</h1>

</section>
<section id="feature-engineering-1" class="slide level2">
<h2>3. Feature engineering</h2>
<ul>
<li><p>Create new features that extract additional insight from existing features</p></li>
<li><p>For example, we could split timestamp “2022-09-23 11:37:48 CDT” into:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>year = 2022</p></li>
<li><p>quarter = 3</p></li>
<li><p>month = 9</p></li>
<li><p>day_of_month = 23</p></li>
<li><p>day_of_week = ‘Friday’</p></li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li><p>hour_24 = 11</p></li>
<li><p>minutes = 37</p></li>
<li><p>seconds = 48</p></li>
<li><p>time_zone = ‘CDT’</p></li>
</ul>
</div>
</div></li>
</ul>
<aside class="notes">
<ul>
<li>In ML, predictor variables are called “features”</li>
<li>Feature engineering is where we take existing variables and create new ones that extract additional information</li>
<li>This allows us to “help” the model understand what we want it to know about a specific var</li>
<li>As an example, this timestamp wouldn’t be helpful as model input.</li>
<li>We can split this field into multiple columns that include date components that the model might want to know about.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-individual-drugs" class="slide level2">
<h2>3. Example: Individual drugs</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>dat_clean <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">ind_didanosine =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="at">pattern=</span><span class="st">'didanosine'</span>, <span class="at">x=</span>treatment_arm), 1L, 0L),</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">ind_zidovudine =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="at">pattern=</span><span class="st">'zidovudine'</span>, <span class="at">x=</span>treatment_arm), 1L, 0L),</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">ind_zalcitabine =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="at">pattern=</span><span class="st">'zalcitabine'</span>, <span class="at">x=</span>treatment_arm), 1L, 0L)</span>
<span id="cb10-6"><a href="#cb10-6"></a>  )</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>dat_clean <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">distinct</span>(treatment_arm, ind_didanosine, ind_zidovudine, ind_zalcitabine) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-4c22903708baf095c33e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c22903708baf095c33e">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4"],["zidovudine and zalcitabine","didanosine","zidovudine","zidovudine and didanosine"],[0,1,0,1],[1,0,1,1],[1,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>treatment_arm<\/th>\n      <th>ind_didanosine<\/th>\n      <th>ind_zidovudine<\/th>\n      <th>ind_zalcitabine<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>As an example, notice that three treatments contain zidovudine and two contain didanosine.</li>
<li>If we use treatment arm as a predictor in its current form, the model wouldn’t understand that some of the treatments contain the same drug</li>
<li>We might help the model by creating indicator variables for the individual drugs</li>
<li>The table on this slide shows how the treatment arms are recoded</li>
<li>This creates some redundancy, though. The treatment arm is completely specified by the indicators. If you know the values of all the individual drug indicators, you know which treatment arm. This could cause some issues in statistical methods. We will see if we run into any issues in the ML model.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="feature-selection" class="title-slide slide level1 center">
<h1>4. Feature selection</h1>

</section>
<section id="feature-selection-1" class="slide level2">
<h2>4. Feature selection</h2>
<ul>
<li><p>Which variables do we want to include in the analysis?</p></li>
<li><p>Which should be excluded?</p>
<ul>
<li><p>Identifier fields, redundant variables, zero-variance variables, etc.</p></li>
<li><p>Keep all variables and let the algorithm figure it out? Or feed it specific variables?</p></li>
</ul></li>
<li><p>Variable reduction - principal components</p></li>
<li><p>Could also choose n top variables from preliminary model fit</p></li>
</ul>
<aside class="notes">
<ul>
<li>The next step is to decide which variables we want to include or exclude from the model</li>
<li>This includes the original variables and the new ones we introduced in the feature engineering step</li>
<li>We want to keep the features that think are relevant to the modeling objective</li>
<li>Exclude features that are redundant (that provide information that other variables already capture)</li>
<li>Exclude features that have zero variance (the same value for all subjects)</li>
<li>After that first cut, we could still be left with hundreds of candidate predictors. Do we keep them all, or try to further reduce the number of variables</li>
<li>Might use a dimension reduction approach such as principal components.</li>
<li>Could also use ML to help with this task. Fit a preliminary ML model, select the top n important features identified in that model.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-keeping-these-variables" class="slide level2">
<h2>4. Example: Keeping these variables</h2>
<ul>
<li><p>Treatment arm assignments (factor + binary indicators)</p></li>
<li><p>Baseline characteristics</p>
<ul>
<li><p>Age, weight, race, gender, sexual orientation, etc.</p></li>
<li><p>Treatment history (including stratification variable)</p></li>
<li><p>CD4 and CD8 counts</p></li>
</ul></li>
<li><p>Symptomatic vs asymptomatic?</p></li>
<li><p>Karnofsky score</p></li>
</ul>
<aside class="notes">
<ul>
<li>Here’s a summary of the variables that I thought might be relevant in the prediction of the primary endpoint</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-excluding-these-variables" class="slide level2">
<h2>4. Example: Excluding these variables</h2>
<ul>
<li><p><u><strong>pidnum</strong></u>: patient identifier shouldn’t be used as a predictor</p></li>
<li><p><u><strong>offtrt</strong></u>: we wouldn’t know this at baseline (whether the patient went off treatment)</p></li>
<li><p><u><strong>prior_z</strong></u>: all patients have prior zidovudine treatment (i.e., all patients have the same value for this variable), so there’s no value add</p></li>
<li><p><u><strong>prior_nz_art</strong></u>: Very little variability in this variable (2092 no vs 47 yes)</p></li>
<li><p><u><strong>CD4 and CD8 measurements at later time points</strong></u>: we wouldn’t know these at baseline</p></li>
</ul>
<aside class="notes">
<ul>
<li>Here’s a list of variables I thought we should exclude.
<ul>
<li>Patient identifier numbers</li>
<li>Things we wouldn’t know at baseline, such as whether the patient went off treatment, and future CD4 and CD8 measurements</li>
<li>The two treatment history variables that had little or no variability</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-analysis-subset" class="slide level2">
<h2>4. Example: Analysis subset</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>var_predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co"># treatment assignment </span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="st">'treatment_arm'</span>, </span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="st">'ind_didanosine'</span>, <span class="st">'ind_zidovudine'</span>, <span class="st">'ind_zalcitabine'</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="co"># baseline predictors</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="st">'age'</span>, <span class="st">'wtkg'</span>, <span class="st">'hemo'</span>, <span class="st">'lgbtq'</span>, <span class="st">'hist_intra_drug_use'</span>, <span class="st">'karnof'</span>, <span class="st">'prior_z_30days'</span>, </span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="st">'days_prior_art'</span>, <span class="st">'race'</span>, <span class="st">'gender'</span>, <span class="st">'prior_art'</span>, <span class="st">'strat_hist_art'</span>, <span class="st">'symptom'</span>, <span class="st">'baseline_cd4'</span>, <span class="st">'baseline_cd8'</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a>var_outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'event'</span>, <span class="st">'surv_event'</span>, <span class="st">'surv_days'</span>, <span class="st">'cd420'</span>, <span class="st">'cd496'</span>, <span class="st">'r'</span>, <span class="st">'cd820'</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a>vars_all <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dat_clean)</span>
<span id="cb11-11"><a href="#cb11-11"></a>vars_to_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(var_predictors, var_outcomes)</span>
<span id="cb11-12"><a href="#cb11-12"></a>vars_excluded <span class="ot">&lt;-</span> vars_all[<span class="sc">!</span>(vars_all <span class="sc">%in%</span> vars_to_keep)]</span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a>dat_analysis <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> <span class="fu">select_at</span>(vars_to_keep)</span>
<span id="cb11-15"><a href="#cb11-15"></a></span>
<span id="cb11-16"><a href="#cb11-16"></a>dat_analysis <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    treatment_arm ind_didanosine   ind_zidovudine  
 didanosine                :561   Min.   :0.0000   Min.   :0.0000  
 zidovudine                :532   1st Qu.:0.0000   1st Qu.:0.0000  
 zidovudine and didanosine :522   Median :1.0000   Median :1.0000  
 zidovudine and zalcitabine:524   Mean   :0.5063   Mean   :0.7377  
                                  3rd Qu.:1.0000   3rd Qu.:1.0000  
                                  Max.   :1.0000   Max.   :1.0000  
                                                                   
 ind_zalcitabine      age             wtkg         hemo      lgbtq     
 Min.   :0.000   Min.   :12.00   Min.   : 31.00   no :1959   no : 725  
 1st Qu.:0.000   1st Qu.:29.00   1st Qu.: 66.68   yes: 180   yes:1414  
 Median :0.000   Median :34.00   Median : 74.39                        
 Mean   :0.245   Mean   :35.25   Mean   : 75.13                        
 3rd Qu.:0.000   3rd Qu.:40.00   3rd Qu.: 82.56                        
 Max.   :1.000   Max.   :70.00   Max.   :159.94                        
                                                                       
 hist_intra_drug_use     karnof       prior_z_30days days_prior_art  
 no :1858            Min.   : 70.00   no : 962       Min.   :   0.0  
 yes: 281            1st Qu.: 90.00   yes:1177       1st Qu.:   0.0  
                     Median :100.00                  Median : 142.0  
                     Mean   : 95.45                  Mean   : 379.2  
                     3rd Qu.:100.00                  3rd Qu.: 739.5  
                     Max.   :100.00                  Max.   :2851.0  
                                                                     
        race         gender           prior_art   
 non-white: 617   female: 368   experienced:1253  
 white    :1522   male  :1771   naive      : 886  
                                                  
                                                  
                                                  
                                                  
                                                  
                                             strat_hist_art         symptom    
 &gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy:410    asymptomatic:1769  
 &gt; 52 weeks                                         :843    symptomatic : 370  
 antiretroviral naive                               :886                       
                                                                               
                                                                               
                                                                               
                                                                               
  baseline_cd4     baseline_cd8    event        surv_event       surv_days     
 Min.   :   0.0   Min.   :  40.0   no :1618   Min.   :0.0000   Min.   :  14.0  
 1st Qu.: 263.5   1st Qu.: 654.0   yes: 521   1st Qu.:0.0000   1st Qu.: 727.0  
 Median : 340.0   Median : 893.0              Median :0.0000   Median : 997.0  
 Mean   : 350.5   Mean   : 986.6              Mean   :0.2436   Mean   : 879.1  
 3rd Qu.: 423.0   3rd Qu.:1207.0              3rd Qu.:0.0000   3rd Qu.:1091.0  
 Max.   :1199.0   Max.   :5011.0              Max.   :1.0000   Max.   :1231.0  
                                                                               
     cd420            cd496              r              cd820       
 Min.   :  49.0   Min.   :   0.0   Min.   :0.0000   Min.   : 124.0  
 1st Qu.: 269.0   1st Qu.: 209.2   1st Qu.:0.0000   1st Qu.: 631.5  
 Median : 353.0   Median : 321.0   Median :1.0000   Median : 865.0  
 Mean   : 371.3   Mean   : 328.6   Mean   :0.6274   Mean   : 935.4  
 3rd Qu.: 460.0   3rd Qu.: 440.0   3rd Qu.:1.0000   3rd Qu.:1146.5  
 Max.   :1119.0   Max.   :1190.0   Max.   :1.0000   Max.   :6035.0  
                  NA's   :797                                       </code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>I applied these variable inclusions and exclusions so that we only keep the relevant columns in the dataset</li>
<li>I kept a few additional outcome fields that we may need in Day 3 of the workshop. These include survival outcomes and future CD4 and CD8 measurements.</li>
<li>Here’s a summary of the dataset that we will use for the analysis.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="split-data-into-training-testing" class="title-slide slide level1 center">
<h1>5. Split data into training / testing</h1>

</section>
<section id="split-data-into-training-testing-1" class="slide level2">
<h2>5. Split data into training / testing</h2>
<ul>
<li><p>Fit the model on the training set(s)</p></li>
<li><p>Get intermediate assessment of model performance on validation set(s)</p></li>
<li><p>Use k-fold cross-validation to train/validate on multiple data splits</p></li>
<li><p>Get final assessment of model performance on testing set</p></li>
</ul>
<aside class="notes">
<ul>
<li>In statistical inference, we usually use the entire dataset to fit the model</li>
<li>However, in prediction, we need to set some data aside to use as a sanity check. We need to see how well the model works on data that it has never seen before.</li>
<li>We can have data split into 3 parts… training, validation, and testing
<ul>
<li>Training: fit the model</li>
<li>Validation: intermediate assessment of model performance. Used to compare model fits across algorithms or parameter settings. Technically still used in training since we are using it to select the model, so it isn’t a completely separate dataset.</li>
<li>Testing: Use this to get a final assessment of model performance after all modeling is complete</li>
<li>Problem with this approach is that we can get an unlucky split. May get different results depending on which cases ended up in training vs validation set</li>
</ul></li>
<li>Another approach: k-fold cross-validation
<ul>
<li>Split the data into training and testing sets</li>
<li>Further split the training data into k folds</li>
<li>Fit the model k times, using (k-1) folds train the model and the held out kth fold for assessment</li>
<li>Average across folds</li>
<li>Gives better assessment of how the model will perform on external data (generalizable) _ I recommend the latter approach</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-train-validationtest-split" class="slide level2">
<h2>5. Example: Train /validation/test split</h2>
<h3 id="initial-data-split">Initial data split</h3>
<p>85 % training / validation + 15% test</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Set the seed so the result is reproducible</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># 85% training / 15% testing</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>dat_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dat_analysis, <span class="at">prop =</span> <span class="fl">0.85</span>, <span class="at">strata =</span> strat_hist_art)</span>
<span id="cb13-5"><a href="#cb13-5"></a>dat_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;1817/322/2139&gt;</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>dat_train_and_val <span class="ot">&lt;-</span> <span class="fu">training</span>(dat_split)</span>
<span id="cb15-2"><a href="#cb15-2"></a>dat_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(dat_split)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>df_dimensions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="at">full_dataset =</span> dat_analysis <span class="sc">%&gt;%</span> dim,</span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="at">train_val_dataset =</span> dat_train_and_val <span class="sc">%&gt;%</span> dim,</span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="at">test_dataset =</span> dat_test <span class="sc">%&gt;%</span> dim</span>
<span id="cb15-8"><a href="#cb15-8"></a>)</span>
<span id="cb15-9"><a href="#cb15-9"></a></span>
<span id="cb15-10"><a href="#cb15-10"></a>df_dim_message <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(df_dimensions), <span class="cf">function</span>(df_name) {</span>
<span id="cb15-11"><a href="#cb15-11"></a>  glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"`{df_name}` contains {df_dimensions[[df_name]][1]} rows and {df_dimensions[[df_name]][2]} columns."</span>)</span>
<span id="cb15-12"><a href="#cb15-12"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="fu">paste</span>(., <span class="at">collapse=</span><span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="fu">cat</span>(df_dim_message)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>`full_dataset` contains 2139 rows and 26 columns.
`train_val_dataset` contains 1817 rows and 26 columns.
`test_dataset` contains 322 rows and 26 columns.</code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>Here’s our initial data split.
<ul>
<li>85% of the data will be used for training and validation across k folds.</li>
<li>The remining 15% will be used for final testing</li>
</ul></li>
<li>Summary at the bottom shows how the two splits add up to the size of the entire dataset</li>
<li>If we are using the k-fold cross validation approach, this is the data split that we would use.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="correct-class-imbalance-issue">Correct class imbalance issue</h3>
<ul>
<li><p>There are 3x as many ‘no’ events as there are ‘yes’ events.</p></li>
<li><p>This can negatively impact model performance.</p></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Show imbalanced distribution of event outcome</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>dat_train_and_val <span class="sc">%&gt;%</span> <span class="fu">count</span>(event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  event    n
1    no 1385
2   yes  432</code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>I mentioned earlier in the data visualization section that there was an issue with the event column.</li>
<li>There are 3x as many ‘no’ events as there are ‘yes’ events.</li>
<li>This is called a class imbalance.</li>
<li>Remember ML models learn from experiences from reviewing example data.</li>
<li>The algorithm will have more examples of ‘no’ events than it does with ‘yes’ events, so it will do a better job predicting the ‘no’ cases.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="correct-class-imbalance-issue-1">Correct class imbalance issue</h3>
<ul>
<li><p>We can use the <code>step_upsample</code> function to over-sample the minority class (i.e., the ‘yes’ class).</p></li>
<li><p>This creates replicate rows of the ‘yes’ records that can artificially make the proportions more balanced</p></li>
<li><p>We would only do this for the training data</p></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Model formula</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>model_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">'event ~ '</span>, <span class="fu">paste</span>(var_predictors, <span class="at">collapse =</span> <span class="st">' + '</span>)))</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># Recipe for upsampling the minority class</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>upsample_rec <span class="ot">&lt;-</span> </span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">recipe</span>(model_formula, <span class="at">data =</span> dat_train_and_val) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">step_upsample</span>(event, <span class="at">over_ratio =</span> <span class="fl">0.7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">prep</span>()</span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co"># Apply the upsampling</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>dat_train_and_val <span class="ot">&lt;-</span> upsample_rec <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) </span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co"># Show new distrubution of event outcome</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>dat_train_and_val <span class="sc">%&gt;%</span>  <span class="fu">count</span>(event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  event     n
  &lt;fct&gt; &lt;int&gt;
1 no     1385
2 yes     969</code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>There is a function in the recipes framework called step_upsample that handles oversampling</li>
<li>After oversampling, now the event distribution is less imbalanced</li>
<li>This is only something that we would need to do for data that will be involved in training the model. No need to do this for the testing set.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="validation-split">Validation split</h3>
<p>80% training + 20% validation</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>dat_val_split <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(dat_train_and_val, <span class="at">prop =</span> <span class="fl">0.80</span>, <span class="at">strata =</span> strat_hist_art)</span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a>dat_train <span class="ot">&lt;-</span> <span class="fu">analysis</span>(dat_val_split<span class="sc">$</span>splits[[<span class="dv">1</span>]])</span>
<span id="cb21-5"><a href="#cb21-5"></a>dat_valid <span class="ot">&lt;-</span> <span class="fu">assessment</span>(dat_val_split<span class="sc">$</span>splits[[<span class="dv">1</span>]])</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>df_dimensions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-8"><a href="#cb21-8"></a>  <span class="at">dat_train_and_val_dataset =</span> dat_train_and_val <span class="sc">%&gt;%</span> dim,</span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="at">train_dataset =</span> dat_train <span class="sc">%&gt;%</span> dim,</span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="at">valid_dataset =</span> dat_valid <span class="sc">%&gt;%</span> dim</span>
<span id="cb21-11"><a href="#cb21-11"></a>)</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a></span>
<span id="cb21-14"><a href="#cb21-14"></a>df_dim_message <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(df_dimensions), <span class="cf">function</span>(df_name) {</span>
<span id="cb21-15"><a href="#cb21-15"></a>  glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"`{df_name}` contains {df_dimensions[[df_name]][1]} rows and {df_dimensions[[df_name]][2]} columns."</span>)</span>
<span id="cb21-16"><a href="#cb21-16"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>  <span class="fu">paste</span>(., <span class="at">collapse=</span><span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="fu">cat</span>(df_dim_message)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>`dat_train_and_val_dataset` contains 2354 rows and 20 columns.
`train_dataset` contains 1882 rows and 20 columns.
`valid_dataset` contains 472 rows and 20 columns.</code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>This step creates a separate validation set.</li>
<li>This is used if you didn’t use k-fold cross validation, so that you have a pre-defined training and validation split.</li>
<li>We will see how both versions are used in the next section.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="train-the-models" class="title-slide slide level1 center">
<h1>6. Train the model(s)</h1>

</section>
<section id="train-the-models-1" class="slide level2">
<h2>6. Train the model(s)</h2>
<ul>
<li><p>Model = modeling algorithm + model formula + algorithm hyperparameter values</p>
<ul>
<li><p>Try different modeling algorithms</p></li>
<li><p>Try different model formulas</p></li>
<li><p>Try different hyperparameter values</p></li>
<li><p>May need to use parallel processing over multiple cores for faster training</p></li>
</ul></li>
<li><p>Model validation - evaluate each model on holdout dataset(s)</p>
<ul>
<li><p>Good: Train on training set + validate on validation set</p></li>
<li><p>Best: Cross-validation on training/validation set</p></li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li>Next step is to train the models
<ul>
<li>Working definition: A model is a specific choice of modeling algorithm, the model formula, and the parameter values to be used in the algorithm</li>
<li>Think of this as an experiment. Try different modeling algorithms, different model formulations, and different hyperparameter values.</li>
<li>This can take a lot of time and computational resources to run, so we may need to use parallel processing over multiple cores if we want to speed up the training</li>
</ul></li>
<li>We also need to validate the model to see how well it works on data it hasn’t seen before.</li>
<li>To summarize my advice on previous slide
<ul>
<li>At minimum, set aside some data in a validation set that you will use to evaluate your model</li>
<li>However I highly recommend that instead of using a single validation split, that you run k-fold cross validation to get a better idea of how generalizable your model is</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="a.-example-benchmark-model" class="slide level2">
<h2>6a. Example: Benchmark model</h2>
<p>We will compare ML model performance to this basic logistic regression fit.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Model specification</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>model_spec_logreg <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">"classification"</span>, <span class="at">engine =</span> <span class="st">"glm"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># Model formula</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>model_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">'event ~ '</span>, <span class="fu">paste</span>(var_predictors, <span class="at">collapse =</span> <span class="st">' + '</span>)))</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co"># Model workflow</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>logreg_model_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_logreg)</span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co"># Train the model</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>model_fit_logreg <span class="ot">&lt;-</span> <span class="fu">fit</span>(logreg_model_wflow, dat_train)</span>
<span id="cb23-12"><a href="#cb23-12"></a></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="co"># Append the predictions to the testing dataframe</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>dat_valid_w_preds_logreg <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_fit_logreg, <span class="at">new_data =</span> dat_valid) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>  <span class="fu">mutate</span>(<span class="at">.pred_yes_int =</span> <span class="fu">ifelse</span>(.pred_yes <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb23-16"><a href="#cb23-16"></a></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="co"># Show the augmented validation dataframe (original data + predictions)</span></span>
<span id="cb23-18"><a href="#cb23-18"></a>dat_valid_w_preds_logreg <span class="sc">%&gt;%</span> pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-6b689da2530fcb98b59d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b689da2530fcb98b59d">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["zidovudine and zalcitabine","zidovudine","zidovudine and didanosine","zidovudine","zidovudine","zidovudine and didanosine","zidovudine and zalcitabine","zidovudine and didanosine","zidovudine","zidovudine and zalcitabine","didanosine","zidovudine and didanosine","zidovudine and didanosine","zidovudine and didanosine","zidovudine and zalcitabine","zidovudine and zalcitabine","zidovudine and didanosine","zidovudine and didanosine","zidovudine","zidovudine"],[0,0,1,0,0,1,0,1,0,0,1,1,1,1,0,0,1,1,0,0],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,0],[39,29,28,40,43,45,39,40,34,39,49,31,31,39,36,36,48,30,40,27],[75.7,66.1,76.6584,71.6688,76.4,82.87272,67.1328,110.4516,72.9,73.9368,80.7408,79.8336,78.1,83.9,61.6896,86.184,83.0088,77.3,55.3392,74.3904],["no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no"],["yes","yes","yes","no","yes","no","no","no","yes","no","yes","yes","no","yes","no","yes","yes","yes","no","yes"],["no","no","no","no","no","no","yes","no","no","no","no","yes","yes","no","no","no","yes","no","no","no"],[100,90,100,100,90,90,100,90,100,100,90,100,90,100,90,100,90,100,100,100],["yes","yes","no","no","yes","yes","yes","yes","yes","no","no","no","yes","no","no","no","no","no","yes","no"],[159,1509,0,0,724,406,1057,179,16,0,0,0,1174,0,0,575,0,0,486,0],["white","white","white","non-white","white","non-white","white","white","white","non-white","white","white","white","white","non-white","white","white","white","non-white","non-white"],["male","male","male","female","male","male","female","male","male","female","male","male","male","male","male","male","male","male","female","male"],["experienced","experienced","naive","naive","experienced","experienced","experienced","experienced","experienced","naive","naive","naive","experienced","naive","naive","experienced","naive","naive","experienced","naive"],["&gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy","&gt; 52 weeks","antiretroviral naive","antiretroviral naive","&gt; 52 weeks","&gt; 52 weeks","&gt; 52 weeks","&gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy","&gt; 1 but &lt;= 52 weeks of prior antiretroviral therapy","antiretroviral naive","antiretroviral naive","antiretroviral naive","&gt; 52 weeks","antiretroviral naive","antiretroviral naive","&gt; 52 weeks","antiretroviral naive","antiretroviral naive","&gt; 52 weeks","antiretroviral naive"],["asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","symptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","asymptomatic","symptomatic"],[431,469,440,440,210,324,470,548,332,420,392,419,257,370,416,337,308,309,338,437],[647,775,1210,493,430,1427,950,1117,1571,730,1566,757,137,630,1326,618,956,806,1664,903],["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"],["no","yes","no","no","yes","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no"],[0.784292811342467,0.460056929320691,0.782805777234955,0.773611910833614,0.29469617346244,0.568227318543993,0.792360175035089,0.821806506823222,0.285612125209292,0.872339539229377,0.621427183364213,0.858621678446729,0.730795186386258,0.794236060235568,0.751417510859172,0.730755609315792,0.739102893685311,0.717174450233723,0.366816335001865,0.639219391399041],[0.215707188657533,0.539943070679309,0.217194222765045,0.226388089166386,0.70530382653756,0.431772681456007,0.207639824964911,0.178193493176778,0.714387874790708,0.127660460770623,0.378572816635787,0.141378321553271,0.269204813613742,0.205763939764432,0.248582489140828,0.269244390684208,0.260897106314689,0.282825549766277,0.633183664998135,0.360780608600959],[0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>treatment_arm<\/th>\n      <th>ind_didanosine<\/th>\n      <th>ind_zidovudine<\/th>\n      <th>ind_zalcitabine<\/th>\n      <th>age<\/th>\n      <th>wtkg<\/th>\n      <th>hemo<\/th>\n      <th>lgbtq<\/th>\n      <th>hist_intra_drug_use<\/th>\n      <th>karnof<\/th>\n      <th>prior_z_30days<\/th>\n      <th>days_prior_art<\/th>\n      <th>race<\/th>\n      <th>gender<\/th>\n      <th>prior_art<\/th>\n      <th>strat_hist_art<\/th>\n      <th>symptom<\/th>\n      <th>baseline_cd4<\/th>\n      <th>baseline_cd8<\/th>\n      <th>event<\/th>\n      <th>.pred_class<\/th>\n      <th>.pred_no<\/th>\n      <th>.pred_yes<\/th>\n      <th>.pred_yes_int<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":22,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":23,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":24,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3,4,5,6,10,12,18,19,22,23,24]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>Before fitting any ML models, I like to fit what is called a “benchmark” model</li>
<li>It is a simple model that probably isn’t very good. However, it’s used as a baseline that we will compare the ML model results to</li>
<li>In this case, I’m choosing to fit a very basic logistic regression model, using the same model formula and training data that I will use to fit the ML models</li>
<li>After fitting the model <code>augment</code> function appends the predicted probabilities of each category in the outcome class to the validation set. It also includes the predicted class, basically whichever class had the higher predicted probability.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="a.-example-benchmark-model-1" class="slide level2">
<h2>6a. Example: Benchmark model</h2>
<p>Logistic regression model accuracy</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Get model performance: Accuracy</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>dat_valid_w_preds_logreg <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  yardstick<span class="sc">::</span><span class="fu">accuracy</span>(<span class="at">truth=</span>event, <span class="at">estimate=</span>.pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-7db00e7c027ed4a02690" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7db00e7c027ed4a02690">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1"],["accuracy"],["binary"],[0.677966101694915]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.metric<\/th>\n      <th>.estimator<\/th>\n      <th>.estimate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>Accuracy = proportion of cases that were correctly classified.</li>
<li>Interpretation: higher accuracy –&gt; better performance</li>
<li>Model accuracy isn’t very high in the logistic regression model</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="a.-example-benchmark-model-2" class="slide level2">
<h2>6a. Example: Benchmark model</h2>
<p>Area under ROC Curve for logistic regression model fit</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Get model performance: Area under the ROC curve</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>dat_valid_w_preds_logreg <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  yardstick<span class="sc">::</span><span class="fu">roc_auc</span>(<span class="at">truth=</span>event, <span class="at">estimate=</span>.pred_yes, <span class="at">event_level=</span><span class="st">'second'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-4a06a0222b5b27ee01bf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4a06a0222b5b27ee01bf">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1"],["roc_auc"],["binary"],[0.706469535737828]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.metric<\/th>\n      <th>.estimator<\/th>\n      <th>.estimate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>AUC = Area under the Receiver Operator Characteristic curve, or ROC curve</li>
<li>Interpretation: higher AUC –&gt; better performance</li>
<li>AUC isn’t very high in the logistic regression model</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="a.-example-benchmark-model-3" class="slide level2">
<h2>6a. Example: Benchmark model</h2>
<p>Confusion matrix: Logistic regression model struggles to correctly predict events.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>cm_logreg <span class="ot">&lt;-</span> dat_valid_w_preds_logreg <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">conf_mat</span>(<span class="at">truth=</span>event, <span class="at">estimate=</span>.pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">autoplot</span>(<span class="at">type=</span><span class="st">'heatmap'</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a>cm_logreg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-6-1.png" width="960"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>Confusion matrix summaries how the predicted values compare to the actual values</li>
<li>Logistic regression model gives lots of false positives and false negatives</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="b.-example-set-up-parallel-backend" class="slide level2">
<h2>6b. Example: Set up parallel backend</h2>
<ul>
<li><p>Machine learning algorithms can be computationally expensive</p></li>
<li><p>Parallelizing these computations over multiple cores can significantly reduce training time</p></li>
<li><p>Code below shows an example parallel backend setup</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1"></a><span class="in">```{r parallel_setup}</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a>cores <span class="ot">&lt;-</span> parallelly<span class="sc">::</span><span class="fu">availableCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-5"><a href="#cb27-5"></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makePSOCKcluster</span>(cores)</span>
<span id="cb27-6"><a href="#cb27-6"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<ul>
<li>Many ways to do this, but this code shows one example setup</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="c.-example-rf-k-fold-cv" class="slide level2">
<h2>6c. Example: RF k-fold CV</h2>
<p>Train a Random Forest model using k-fold cross-validation</p>
<ul>
<li><p>Same model formula used in the logistic regression (benchmark model)</p></li>
<li><p>Using the Random Forest implementation provided in the <code>ranger</code> package</p></li>
<li><p>Setting specific values for selected hyperparameters (<code>trees</code>, <code>mtry</code>, and <code>min_n</code>)</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="example-rf-k-fold-cv">Example: RF k-fold CV</h3>
<ul>
<li><p>In each step, fit models on (k-1) folds combined and evaluate performance on remaining fold</p></li>
<li><p>Fold splits are stratified by patient’s history of anti-retroviral therapy</p></li>
<li><p>Saving predictions on holdout folds for later use</p></li>
<li><p>Default performance metrics for binary classification: accuracy + AUC</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="code">Code</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1"></a><span class="in">```{r rf_train_w_cv}</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co"># Generate k folds for CV</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>num_folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>dat_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(dat_train_and_val, <span class="at">v =</span> num_folds, <span class="at">strata =</span> strat_hist_art)</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co"># Save the assessment set results</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-10"><a href="#cb28-10"></a></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co"># Model specification</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>model_spec_rf <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mode =</span> <span class="st">'classification'</span>, <span class="at">engine =</span> <span class="st">'ranger'</span>, </span>
<span id="cb28-13"><a href="#cb28-13"></a>                             <span class="at">trees =</span> <span class="dv">300</span>, <span class="at">mtry =</span> <span class="dv">10</span>, <span class="at">min_n =</span> <span class="dv">100</span>)</span>
<span id="cb28-14"><a href="#cb28-14"></a></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co"># Model formula</span></span>
<span id="cb28-16"><a href="#cb28-16"></a>model_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">'event ~ '</span>, <span class="fu">paste</span>(var_predictors, <span class="at">collapse =</span> <span class="st">' + '</span>)))</span>
<span id="cb28-17"><a href="#cb28-17"></a></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="co"># Model workflow</span></span>
<span id="cb28-19"><a href="#cb28-19"></a>rf_model_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_rf)</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co"># k-fold cross validation of the random forest model</span></span>
<span id="cb28-22"><a href="#cb28-22"></a>fit_cv_res <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(rf_model_wflow, dat_folds, <span class="at">control =</span> ctrl)</span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c.-rf-k-fold-cv" class="slide level2">
<h2>6c. RF k-fold CV</h2>
<ul>
<li><p>Evaluate model performance</p>
<ul>
<li><p>Aggregate performance metrics across folds</p></li>
<li><p>Shows mean, standard error, and n = # folds</p></li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>fit_cv_res <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">pretty_dt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-aa6e44585158052e8af7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-aa6e44585158052e8af7">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2"],["accuracy","roc_auc"],["binary","binary"],[0.763349656951358,0.83498141197273],[5,5],[0.0193105793784417,0.00996596592884503],["Preprocessor1_Model1","Preprocessor1_Model1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.metric<\/th>\n      <th>.estimator<\/th>\n      <th>mean<\/th>\n      <th>n<\/th>\n      <th>std_err<\/th>\n      <th>.config<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[3,4,5]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="c.-rf-k-fold-cv-1" class="slide level2">
<h2>6c. RF k-fold CV</h2>
<ul>
<li><p>Get predictions on the held-out folds</p></li>
<li><p>Predicted probability of yes or no</p></li>
<li><p>Predicted class = whichever has highest predicted probability</p></li>
<li><p>Also includes the true classification column <code>event</code> for comparison purposes</p></li>
</ul>
</section>
<section class="slide level2">

<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>fit_cv_res <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">pretty_dt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-a34b34980ef81f62c5e6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a34b34980ef81f62c5e6">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1","Fold1"],[0.880087192814745,0.516312015732011,0.561806704313741,0.495155747837037,0.686990876952118,0.584657232984979,0.556767844829154,0.567720022201775,0.871080624893879,0.883196657652289,0.489783779397969,0.836028939022556,0.661528800395404,0.609139135455884,0.893540689600632,0.751398638083507,0.698876378127063,0.89487695549398,0.499061518893374,0.669333604079683],[0.119912807185255,0.483687984267989,0.438193295686259,0.504844252162963,0.313009123047882,0.415342767015022,0.443232155170847,0.432279977798225,0.128919375106121,0.11680334234771,0.510216220602031,0.163971060977444,0.338471199604596,0.390860864544116,0.106459310399367,0.248601361916493,0.301123621872937,0.10512304450602,0.500938481106626,0.330666395920316],[7,11,14,15,18,20,32,34,36,58,59,62,69,73,81,85,95,105,107,109],["no","no","no","yes","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","yes","no"],["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"],["Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>.pred_no<\/th>\n      <th>.pred_yes<\/th>\n      <th>.row<\/th>\n      <th>.pred_class<\/th>\n      <th>event<\/th>\n      <th>.config<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="d.-example-multiple-models" class="slide level2">
<h2>6d. Example: Multiple models</h2>
<ul>
<li><p>Fit Random forest, XGBoost, and Logistic regression models in a single workflow</p></li>
<li><p>Can test various model formula and algorithm combinations</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1"></a><span class="in">```{r multi_model_train_w_cv}</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co"># Generate k folds for CV</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>num_folds <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>dat_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(dat_train_and_val, <span class="at">v =</span> num_folds, <span class="at">strata =</span> strat_hist_art)</span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co"># Save the assessment set results</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co"># Model specifications</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>model_spec_rf <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mode =</span> <span class="st">'classification'</span>, <span class="at">engine =</span> <span class="st">'ranger'</span>, <span class="at">trees =</span> <span class="dv">300</span>, </span>
<span id="cb31-13"><a href="#cb31-13"></a>                             <span class="at">mtry =</span> <span class="dv">10</span>, <span class="at">min_n =</span> <span class="dv">25</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">#model_spec_dt &lt;- decision_tree(mode = 'classification', engine = 'rpart', tree_depth = 5, </span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">#                               min_n = 20)</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>model_spec_xgb <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">mode =</span> <span class="st">'classification'</span>, <span class="at">engine =</span> <span class="st">'xgboost'</span>, <span class="at">trees =</span> <span class="dv">250</span>,</span>
<span id="cb31-17"><a href="#cb31-17"></a>                             <span class="at">tree_depth =</span> <span class="dv">5</span>, <span class="at">min_n =</span> <span class="dv">30</span>, <span class="at">learn_rate =</span> <span class="fl">0.5</span>)</span>
<span id="cb31-18"><a href="#cb31-18"></a>model_spec_logreg <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">"classification"</span>, <span class="at">engine =</span> <span class="st">"glm"</span>)</span>
<span id="cb31-19"><a href="#cb31-19"></a></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="co"># Model formula</span></span>
<span id="cb31-21"><a href="#cb31-21"></a>model_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">'event ~ '</span>, <span class="fu">paste</span>(var_predictors, <span class="at">collapse =</span> <span class="st">' + '</span>)))</span>
<span id="cb31-22"><a href="#cb31-22"></a></span>
<span id="cb31-23"><a href="#cb31-23"></a><span class="co"># Model workflows</span></span>
<span id="cb31-24"><a href="#cb31-24"></a>rf_model_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_rf)</span>
<span id="cb31-25"><a href="#cb31-25"></a><span class="co">#dt_model_wflow &lt;- workflow(model_formula, model_spec_dt)</span></span>
<span id="cb31-26"><a href="#cb31-26"></a>xgb_model_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_xgb)</span>
<span id="cb31-27"><a href="#cb31-27"></a>logreg_model_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_logreg)</span>
<span id="cb31-28"><a href="#cb31-28"></a></span>
<span id="cb31-29"><a href="#cb31-29"></a>wf_set <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(<span class="fu">list</span>(model_formula), </span>
<span id="cb31-30"><a href="#cb31-30"></a>                       <span class="fu">list</span>(model_spec_logreg, model_spec_rf, model_spec_xgb))</span>
<span id="cb31-31"><a href="#cb31-31"></a></span>
<span id="cb31-32"><a href="#cb31-32"></a>wf_set_fit <span class="ot">&lt;-</span> wf_set <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33"></a>  <span class="fu">workflow_map</span>(<span class="st">"fit_resamples"</span>, <span class="at">resamples =</span> dat_folds)</span>
<span id="cb31-34"><a href="#cb31-34"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<ul>
<li>Tidymodels provides a convenient framework for fitting multiple models</li>
<li>Here, we specify RF, XGB, and Logistic regression model using specific values of their hyperparameters</li>
<li>Put them all together into a single workflow set using the <code>workflow_set</code> function
<ul>
<li>Could have used multiple model formulations, for example if we wante to explore different variable subsets</li>
</ul></li>
<li>Run all combinations of model formulas and model specifications using the <code>workflow_map</code> function</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="d.-example-multiple-models-1" class="slide level2">
<h2>6d. Example: Multiple models</h2>
<p>Leaderboard shows model performance rankings across modeling scenarios</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Rank the sets of models by their aggregate metric performance</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>leaderboard <span class="ot">&lt;-</span> wf_set_fit <span class="sc">%&gt;%</span> <span class="fu">rank_results</span>()</span>
<span id="cb32-3"><a href="#cb32-3"></a>leaderboard <span class="sc">%&gt;%</span> <span class="fu">pretty_dt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-e784c3fa380f318ff005" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e784c3fa380f318ff005">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6"],["formula_rand_forest","formula_rand_forest","formula_boost_tree","formula_boost_tree","formula_logistic_reg","formula_logistic_reg"],["Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1","Preprocessor1_Model1"],["accuracy","roc_auc","accuracy","roc_auc","accuracy","roc_auc"],[0.846653557262506,0.912457503491465,0.833046983492653,0.885090641109191,0.668229596846805,0.70318245623449],[0.00451522882966764,0.00164220583161298,0.00640930232460071,0.00435371196864467,0.00273486175191353,0.00686656788409845],[3,3,3,3,3,3],["formula","formula","formula","formula","formula","formula"],["rand_forest","rand_forest","boost_tree","boost_tree","logistic_reg","logistic_reg"],[1,1,2,2,3,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>wflow_id<\/th>\n      <th>.config<\/th>\n      <th>.metric<\/th>\n      <th>mean<\/th>\n      <th>std_err<\/th>\n      <th>n<\/th>\n      <th>preprocessor<\/th>\n      <th>model<\/th>\n      <th>rank<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[4,5,6,9]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>Leaderboard ranks model performance across the different modeling scenarios</li>
<li>Random forest is in first place, followed by XGBoost.</li>
<li>Both beat our benchmark logistic regression model</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="e.-example-param-tuning-w-cv" class="slide level2">
<h2>6e. Example — Param tuning w/ CV</h2>
<p>Tune hyperparameters</p>
<ul>
<li><p>Fit the same algorithm multiple times using different parameter values</p></li>
<li><p>Choose the parameter combination that optimizes model performance</p></li>
<li><p>Can choose grid search approach - Latin Hypercube, Max entropy, Regular, etc</p></li>
<li><p>Can choose parameter value ranges or have them automatically selected</p></li>
</ul>
<aside class="notes">
<ul>
<li>What I hear: “I tried random forest, but it didn’t give great results.”</li>
<li>What that usually means: “I tried one specific set of parameter values for random forest, and it didn’t give great results.”</li>
<li>Parameter value settings can have a significant impact on the model performance. We need to find the combination of parameters that work well or the specific modeling exercise.</li>
<li>Grid search = try a bunch of different parameter combinations; choose the set of values that optimizes the performance metric
<ul>
<li>Several grid search approaches in tidymodels framework: latin hypercube, max entropy, regular, etc</li>
<li>Can have the algorithm choose value ranges for you, or you could set them yourself</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="code-1">Code</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1"></a><span class="in">```{r xgb_param_tune_w_cv}</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="fu">set.seed</span>(<span class="dv">9265</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co"># Generate k folds for CV</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>num_folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>dat_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(dat_train_and_val, <span class="at">v =</span> num_folds, <span class="at">strata =</span> strat_hist_art)</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co"># Model specifications</span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="co"># Some parameters are specified, while others are marked for tuning </span></span>
<span id="cb33-12"><a href="#cb33-12"></a>model_spec_xgb_tune <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">mode =</span> <span class="st">'classification'</span>, <span class="at">engine =</span> <span class="st">'xgboost'</span>, <span class="at">trees =</span> <span class="fu">tune</span>(),</span>
<span id="cb33-13"><a href="#cb33-13"></a>                             <span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="dv">54</span>, <span class="at">learn_rate =</span> <span class="fu">tune</span>(), </span>
<span id="cb33-14"><a href="#cb33-14"></a>                             <span class="at">mtry =</span> <span class="fu">tune</span>())</span>
<span id="cb33-15"><a href="#cb33-15"></a></span>
<span id="cb33-16"><a href="#cb33-16"></a><span class="co"># Save the assessment set results</span></span>
<span id="cb33-17"><a href="#cb33-17"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">allow_par=</span><span class="cn">TRUE</span>, <span class="at">parallel_over =</span> <span class="st">"everything"</span>, </span>
<span id="cb33-18"><a href="#cb33-18"></a>                     <span class="at">verbose=</span><span class="cn">TRUE</span>, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb33-19"><a href="#cb33-19"></a></span>
<span id="cb33-20"><a href="#cb33-20"></a><span class="co"># Model formula</span></span>
<span id="cb33-21"><a href="#cb33-21"></a>model_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">'event ~ '</span>, <span class="fu">paste</span>(var_predictors, <span class="at">collapse =</span> <span class="st">' + '</span>)))</span>
<span id="cb33-22"><a href="#cb33-22"></a></span>
<span id="cb33-23"><a href="#cb33-23"></a><span class="co"># Model workflow</span></span>
<span id="cb33-24"><a href="#cb33-24"></a>xgb_model_wflow_tune <span class="ot">&lt;-</span> <span class="fu">workflow</span>(model_formula, model_spec_xgb_tune)</span>
<span id="cb33-25"><a href="#cb33-25"></a></span>
<span id="cb33-26"><a href="#cb33-26"></a>xgb_param <span class="ot">&lt;-</span> </span>
<span id="cb33-27"><a href="#cb33-27"></a>  xgb_model_wflow_tune <span class="sc">%&gt;%</span> </span>
<span id="cb33-28"><a href="#cb33-28"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-29"><a href="#cb33-29"></a>  <span class="fu">update</span>(</span>
<span id="cb33-30"><a href="#cb33-30"></a>    <span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">1500</span>)),</span>
<span id="cb33-31"><a href="#cb33-31"></a>    <span class="at">learn_rate =</span> <span class="fu">learn_rate</span>(<span class="fu">c</span>(.<span class="dv">00005</span>, .<span class="dv">1</span>), <span class="at">trans=</span> <span class="cn">NULL</span>),</span>
<span id="cb33-32"><a href="#cb33-32"></a>    <span class="at">tree_depth =</span> <span class="fu">tree_depth</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">20</span>)),</span>
<span id="cb33-33"><a href="#cb33-33"></a>    <span class="at">mtry =</span> <span class="fu">mtry</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">20</span>))</span>
<span id="cb33-34"><a href="#cb33-34"></a>  )</span>
<span id="cb33-35"><a href="#cb33-35"></a></span>
<span id="cb33-36"><a href="#cb33-36"></a><span class="co"># Tune the hyperparameters using k-fold cross validation</span></span>
<span id="cb33-37"><a href="#cb33-37"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb33-38"><a href="#cb33-38"></a>tm <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb33-39"><a href="#cb33-39"></a>  xgb_res <span class="ot">&lt;-</span></span>
<span id="cb33-40"><a href="#cb33-40"></a>    xgb_model_wflow_tune <span class="sc">%&gt;%</span></span>
<span id="cb33-41"><a href="#cb33-41"></a>    <span class="fu">tune_grid</span>(<span class="at">resamples =</span> dat_folds, </span>
<span id="cb33-42"><a href="#cb33-42"></a>              <span class="at">grid =</span> xgb_param <span class="sc">%&gt;%</span> <span class="fu">grid_max_entropy</span>(<span class="at">size =</span> <span class="dv">100</span>),</span>
<span id="cb33-43"><a href="#cb33-43"></a>              <span class="at">control =</span> ctrl)</span>
<span id="cb33-44"><a href="#cb33-44"></a>})</span>
<span id="cb33-45"><a href="#cb33-45"></a></span>
<span id="cb33-46"><a href="#cb33-46"></a><span class="co"># How long did it take to run?</span></span>
<span id="cb33-47"><a href="#cb33-47"></a><span class="fu">print</span>(tm)</span>
<span id="cb33-48"><a href="#cb33-48"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.926   0.750 117.567 </code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>Example: tune parameters in the XGBoost algorithm</li>
<li>Using 5-fold cross validation to assess the performance of each parameter combination across folds</li>
<li>Use the tune() function to indicate that we want to train 4 important parameters in the XGBoost model
<ul>
<li>number of trees, learning rate, tree depth, and mtry</li>
</ul></li>
<li>In this example, I specifically set the parameter ranges that I want the grid search to focus on</li>
<li>And then I use the max entropy method to select 100 different parameter combinations</li>
<li>As you can see, it took some time to run</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="e.-example-param-tuning-w-cv-1" class="slide level2">
<h2>6e. Example — Param tuning w/ CV</h2>
<p>Summarize model performance metrics across folds</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>xgb_res <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'roc_auc'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-7c9edebbe7a9563ac26c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7c9edebbe7a9563ac26c">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,6,6,6],[1327,1170,855,1158,1344,588,594,1128,987,217,839,441,1164,969,1472,549,404,1419,1486,1372],[5,7,9,15,5,6,12,14,14,15,17,17,18,19,13,18,19,5,6,8],[0.00254957582367351,0.0243159519884037,0.0146805804258329,0.0553313889769605,0.0997989159637829,0.0205189070739434,0.035569909024681,0.0267443444857723,0.0690918528113165,0.00698534466210986,0.0279530117585557,0.0397375199546106,0.0723127264787909,0.0187981477434165,0.0877256885797484,0.086601771616796,0.0164499973460333,0.0429676587202004,0.00853467310153646,0.0241826337304199],["roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc","roc_auc"],["binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary","binary"],[0.714200983259457,0.763129189737974,0.739340502997574,0.787165932679061,0.824445618421626,0.743846960311825,0.760638319644494,0.77215902502805,0.799031307779839,0.705606100905544,0.762609462800966,0.75586311380786,0.806468988671379,0.756453916606873,0.829600224991029,0.792476690698719,0.734365843393076,0.804515479998172,0.752562506910228,0.784207895608143],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],[0.0120565085486827,0.0106287270243548,0.011295626404594,0.0111608680252451,0.0128134543882215,0.0103102898801414,0.0104857827009493,0.011126570578537,0.0109758507103662,0.0143300303473854,0.0113926147379554,0.0116711848803124,0.0123201740139599,0.0114943358077584,0.0130062419413584,0.0106101052845152,0.0115811756019904,0.0109941015742595,0.0114602377930705,0.0108877342281836],["Preprocessor1_Model001","Preprocessor1_Model002","Preprocessor1_Model003","Preprocessor1_Model004","Preprocessor1_Model005","Preprocessor1_Model006","Preprocessor1_Model007","Preprocessor1_Model008","Preprocessor1_Model009","Preprocessor1_Model010","Preprocessor1_Model011","Preprocessor1_Model012","Preprocessor1_Model013","Preprocessor1_Model014","Preprocessor1_Model015","Preprocessor1_Model016","Preprocessor1_Model017","Preprocessor1_Model018","Preprocessor1_Model019","Preprocessor1_Model020"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mtry<\/th>\n      <th>trees<\/th>\n      <th>tree_depth<\/th>\n      <th>learn_rate<\/th>\n      <th>.metric<\/th>\n      <th>.estimator<\/th>\n      <th>mean<\/th>\n      <th>n<\/th>\n      <th>std_err<\/th>\n      <th>.config<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,7,8,9]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>AUC metrics averaged across folds for each parameter combination in the grid search</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="e.-example-param-tuning-w-cv-2" class="slide level2">
<h2>6e. Example — Param tuning w/ CV</h2>
<p>Show the top XGBoost model</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># top model</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>xgb_res <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">show_best</span>(<span class="at">metric =</span> <span class="st">'roc_auc'</span>, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4"></a>  pretty_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-8f7ac08eb04ef13bf0fd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f7ac08eb04ef13bf0fd">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1"],[16],[1385],[17],[0.0924847716008197],["roc_auc"],["binary"],[0.848391763863541],[5],[0.011549706729051],["Preprocessor1_Model084"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mtry<\/th>\n      <th>trees<\/th>\n      <th>tree_depth<\/th>\n      <th>learn_rate<\/th>\n      <th>.metric<\/th>\n      <th>.estimator<\/th>\n      <th>mean<\/th>\n      <th>n<\/th>\n      <th>std_err<\/th>\n      <th>.config<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"tip","scrollX":true,"scrollY":true,"initComplete":"function(settings, json) {\n$(this.api().table().header()).css({'color': 'white'});\n}","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,7,8,9]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.initComplete","options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<aside class="notes">
<ul>
<li>The <code>show_best</code> function allows us to select the optimal parameter combination, i.e., the one that gives the highest AUC</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="e.-example-stop-the-cluster" class="slide level2">
<h2>6e. Example — Stop the cluster</h2>
<p>Shut down the parallel backend</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1"></a><span class="in">```{r parallel_close}</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a>foreach<span class="sc">::</span><span class="fu">registerDoSEQ</span>()</span>
<span id="cb37-5"><a href="#cb37-5"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>Don’t forget to shut down the cluster after you are done training your models!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="create-visual-summaries" class="title-slide slide level1 center">
<h1>7. Create visual summaries</h1>

</section>
<section id="create-visual-summaries-1" class="slide level2">
<h2>7. Create visual summaries</h2>
<p>Visual model summaries can often provide additional insight</p>
<ul>
<li><p>Compare model performance across modeling scenarios</p></li>
<li><p>Compare predicted values to observed</p>
<ul>
<li><p>Regression: scatterplot</p></li>
<li><p>Classification: confusion matrix</p></li>
</ul></li>
</ul>
</section>
<section id="example-model-performance-across-tuning-scenarios" class="slide level2">
<h2>7. Example: Model performance across tuning scenarios</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>xgb_tune_metrics <span class="ot">&lt;-</span> xgb_res <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">mutate</span>(<span class="at">scenario =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"learn_rate = {signif(learn_rate, 3)}; trees = {trees}; tree_depth = {tree_depth}"</span>))</span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a>plot_tune_metrics_xgb <span class="ot">&lt;-</span> xgb_tune_metrics <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="co">#filter(.metric == 'roc_auc') %&gt;% </span></span>
<span id="cb38-7"><a href="#cb38-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>scenario)) <span class="sc">+</span> </span>
<span id="cb38-8"><a href="#cb38-8"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>scenario, <span class="at">y=</span>mean)) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>std_err, <span class="at">ymax=</span>mean<span class="sc">+</span>std_err), <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb38-10"><a href="#cb38-10"></a>                 <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric) <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb38-13"><a href="#cb38-13"></a></span>
<span id="cb38-14"><a href="#cb38-14"></a>plot_tune_metrics_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/xgb_tune_metrics-1.png" width="960"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>Sorry for the small print!</li>
<li>Each row shows the mean +/- SE for the accuracy and AUC measurements for a specific parameter combination in the XGBoost grid search</li>
<li>Lots of variability in performance</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-roc-vs-param-value" class="slide level2">
<h2>7. Example: ROC vs param value</h2>
<ul>
<li><p>Plotting the model performance against the parameter values in the grid can often reveal trends that can help refine the grid for better performance.</p></li>
<li><p>For example… Model performance tends to increase with learning rate</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="plots-learning-rate-and-num.-trees">Plots: Learning rate and num. trees</h3>
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>plot_param <span class="ot">&lt;-</span> <span class="cf">function</span>(param) {</span>
<span id="cb39-2"><a href="#cb39-2"></a>  xgb_tune_metrics <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'roc_auc'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>    <span class="fu">arrange_at</span>(<span class="st">'mean'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>    <span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>param, <span class="at">y=</span><span class="st">'mean'</span>)) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb39-7"><a href="#cb39-7"></a>    <span class="fu">xlab</span>(param) <span class="sc">+</span> </span>
<span id="cb39-8"><a href="#cb39-8"></a>    <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> </span>
<span id="cb39-9"><a href="#cb39-9"></a>    <span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"ROC vs {param}"</span>))</span>
<span id="cb39-10"><a href="#cb39-10"></a>}</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="fu">plot_param</span>(<span class="st">'learn_rate'</span>)</span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="fu">plot_param</span>(<span class="st">'trees'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-10-1.png" width="960"></p>
<p></p><figcaption>Learning rate</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-10-2.png" width="960"></p>
<p></p><figcaption>Number of trees</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Learning rate = Curved relationship; variance increases with learning rate; best performance seems to occur with higher learning rate</li>
<li>Similar for number of trees</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="plots-tree-depth-and-mtry">Plots: Tree depth and mtry</h3>
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">plot_param</span>(<span class="st">'tree_depth'</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="fu">plot_param</span>(<span class="st">'mtry'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-11-1.png" width="960"></p>
<p></p><figcaption>Tree depth</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-11-2.png" width="960"></p>
<p></p><figcaption>Mtry</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Tree depth and mtry don’t seem to affect model performance as much here</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-select-the-best-model" class="slide level2">
<h2>7. Example: Select the best model</h2>
<ul>
<li><p>Best model is the one that optimizes the performance metric</p></li>
<li><p>For example, we could choose the model with highest AUC</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="code-2">Code</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="do">## XGBoost model that has the best AUC</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>best_auc <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xgb_res, <span class="at">metric =</span> <span class="st">"roc_auc"</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="do">## Workflow associated with the best AUC</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>best_xgb_wflow <span class="ot">&lt;-</span> xgb_model_wflow_tune <span class="sc">%&gt;%</span> </span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">finalize_workflow</span>(best_auc)</span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="do">## The final model fit</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>final_model_fit <span class="ot">&lt;-</span> </span>
<span id="cb41-10"><a href="#cb41-10"></a>  best_xgb_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-11"><a href="#cb41-11"></a>  <span class="fu">fit</span>(<span class="at">data =</span> dat_train)</span>
<span id="cb41-12"><a href="#cb41-12"></a></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="fu">print</span>(final_model_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Formula
Model: boost_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
event ~ treatment_arm + ind_didanosine + ind_zidovudine + ind_zalcitabine + 
    age + wtkg + hemo + lgbtq + hist_intra_drug_use + karnof + 
    prior_z_30days + days_prior_art + race + gender + prior_art + 
    strat_hist_art + symptom + baseline_cd4 + baseline_cd8

── Model ───────────────────────────────────────────────────────────────────────
##### xgb.Booster
raw: 1.2 Mb 
call:
  xgboost::xgb.train(params = list(eta = 0.0924847716008197, max_depth = 17L, 
    gamma = 0, colsample_bytree = 1, colsample_bynode = 0.5, 
    min_child_weight = 54, subsample = 1), data = x$data, nrounds = 1385L, 
    watchlist = x$watchlist, verbose = 0, nthread = 1, objective = "binary:logistic")
params (as set within xgb.train):
  eta = "0.0924847716008197", max_depth = "17", gamma = "0", colsample_bytree = "1", colsample_bynode = "0.5", min_child_weight = "54", subsample = "1", nthread = "1", objective = "binary:logistic", validate_parameters = "TRUE"
xgb.attributes:
  niter
callbacks:
  cb.evaluation.log()
# of features: 32 
niter: 1385
nfeatures : 32 
evaluation_log:
    iter training_logloss
       1        0.6818197
       2        0.6731883
---                      
    1384        0.3370586
    1385        0.3370031</code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>Scroll down to see the rest of the output</li>
<li>This view shows the details of the final XGBoost model fit using the optimal combination of parameters</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="explain-model-predictions" class="title-slide slide level1 center">
<h1>8. Explain model predictions</h1>

</section>
<section id="explain-model-predictions-1" class="slide level2">
<h2>8. Explain model predictions</h2>
<ul>
<li>Understand the patterns that the model has learned</li>
<li>What does it understand about the relationship between the outcome and predictors?
<ul>
<li>Any new insights?</li>
<li>Does any learned relationship clash with your intuition?</li>
</ul></li>
<li>Can summarize individual and interactive importance of the predictors</li>
<li>Can provide global summary of overall relationships vs local explanations of individual predictions</li>
<li>Will provide more details on Day 3</li>
</ul>
<aside class="notes">
<ul>
<li>Tools for explainable AI, or xAI available in R and python</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-model-explainer" class="slide level2">
<h2>8. Example: Model explainer</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>xgb_explainer <span class="ot">&lt;-</span> <span class="fu">explain_tidymodels</span>(</span>
<span id="cb43-2"><a href="#cb43-2"></a>  final_model_fit,</span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="at">data =</span> dat_train,</span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="co"># DALEX required an integer for factors:</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="at">y =</span> <span class="fu">as.integer</span>(dat_train<span class="sc">$</span>event) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb43-6"><a href="#cb43-6"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  workflow  (  default  )
  -&gt; data              :  1882  rows  20  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  1882  values 
  -&gt; predict function  :  yhat.workflow  will be used (  default  )
  -&gt; predicted values  :  No value for predict function target column. (  default  )
  -&gt; model_info        :  package tidymodels , ver. 1.0.0 , task classification (  default  ) 
  -&gt; predicted values  :  numerical, min =  0.007486761 , mean =  0.4165853 , max =  0.9883219  
  -&gt; residual function :  difference between y and yhat (  default  )
  -&gt; residuals         :  numerical, min =  -0.9161886 , mean =  -7.166723e-06 , max =  0.9464752  
  A new explainer has been created!  </code></pre>
</div>
</div>
<aside class="notes">
<ul>
<li>Create a model explainer that will run the</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-pdp" class="slide level2">
<h2>8. Example: PDP</h2>
<ul>
<li>Partial dependence profiles show relationship between predicted probabilities and the values of individual predictors.</li>
</ul>
<aside class="notes">

<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<p>PDP grouped by treatment arm</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Plots 1 - 2</a></li><li><a href="#tabset-3-2">Plots 3 - 4</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># https://ema.drwhy.ai/partialDependenceProfiles.html</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>plot_pdp <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, explainer, input_vars, group_var) {</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">set.seed</span>(<span class="dv">86329</span>)</span>
<span id="cb45-4"><a href="#cb45-4"></a>  </span>
<span id="cb45-5"><a href="#cb45-5"></a>  pdp_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(input_vars, <span class="cf">function</span>(vname) {</span>
<span id="cb45-6"><a href="#cb45-6"></a>    var_splits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">unique</span>(dat[[vname]]))</span>
<span id="cb45-7"><a href="#cb45-7"></a>    <span class="fu">names</span>(var_splits) <span class="ot">&lt;-</span> vname</span>
<span id="cb45-8"><a href="#cb45-8"></a>    </span>
<span id="cb45-9"><a href="#cb45-9"></a>    <span class="fu">model_profile</span>(</span>
<span id="cb45-10"><a href="#cb45-10"></a>      xgb_explainer,</span>
<span id="cb45-11"><a href="#cb45-11"></a>      <span class="at">variables =</span> vname,</span>
<span id="cb45-12"><a href="#cb45-12"></a>      <span class="at">N =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-13"><a href="#cb45-13"></a>      <span class="at">groups =</span> group_var,</span>
<span id="cb45-14"><a href="#cb45-14"></a>      <span class="at">variable_splits =</span> var_splits</span>
<span id="cb45-15"><a href="#cb45-15"></a>    )</span>
<span id="cb45-16"><a href="#cb45-16"></a>  })</span>
<span id="cb45-17"><a href="#cb45-17"></a>  </span>
<span id="cb45-18"><a href="#cb45-18"></a>  <span class="fu">lapply</span>(pdp_list, plot)</span>
<span id="cb45-19"><a href="#cb45-19"></a>}</span>
<span id="cb45-20"><a href="#cb45-20"></a></span>
<span id="cb45-21"><a href="#cb45-21"></a></span>
<span id="cb45-22"><a href="#cb45-22"></a><span class="fu">plot_pdp</span>(<span class="at">dat =</span> dat_train, <span class="at">explainer =</span> xgb_explainer, </span>
<span id="cb45-23"><a href="#cb45-23"></a>         <span class="at">input_vars=</span><span class="st">'age'</span>, <span class="at">group_var=</span><span class="st">'treatment_arm'</span>)[[<span class="dv">1</span>]]</span>
<span id="cb45-24"><a href="#cb45-24"></a><span class="fu">plot_pdp</span>(<span class="at">dat =</span> dat_train, <span class="at">explainer=</span>xgb_explainer, </span>
<span id="cb45-25"><a href="#cb45-25"></a>         <span class="at">input_vars=</span><span class="st">'karnof'</span>, <span class="at">group_var=</span><span class="st">'treatment_arm'</span>)[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
<p></p><figcaption>Age</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-14-2.png" width="960"></p>
<p></p><figcaption>Karnofsky</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">plot_pdp</span>(<span class="at">dat =</span> dat_train, <span class="at">explainer=</span>xgb_explainer, </span>
<span id="cb46-2"><a href="#cb46-2"></a>         <span class="at">input_vars=</span><span class="st">'days_prior_art'</span>, <span class="at">group_var=</span><span class="st">'treatment_arm'</span>)[[<span class="dv">1</span>]]</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="fu">plot_pdp</span>(<span class="at">dat =</span> dat_train, <span class="at">explainer=</span>xgb_explainer, </span>
<span id="cb46-4"><a href="#cb46-4"></a>         <span class="at">input_vars=</span><span class="st">'baseline_cd8'</span>, <span class="at">group_var=</span><span class="st">'treatment_arm'</span>)[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-15-1.png" width="960"></p>
<p></p><figcaption>Days on prior ART</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="2022_sdna_ML_workshop_day_2_files/figure-revealjs/unnamed-chunk-15-2.png" width="960"></p>
<p></p><figcaption>Baseline CD8</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<aside class="notes">

<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="deploy-the-model" class="title-slide slide level1 center">
<h1>9. Deploy the model</h1>

</section>
<section id="deploy-the-model-1" class="slide level2">
<h2>9. Deploy the model</h2>
<ul>
<li><p>Model deployment: integrate a machine learning model and integrate it into an existing production environment where it can take in an input and return an output.</p></li>
<li><p>Make the predictions from a trained ML model available to others, whether that be users, management, or other systems.</p></li>
<li><p>Model deployment will be discussed in the hands-on session on Day 3.</p></li>
</ul>
<div class="footer">
<p>Source: <a href="https://towardsdatascience.com/what-does-it-mean-to-deploy-a-machine-learning-model-dddb983ac416" class="uri">https://towardsdatascience.com/what-does-it-mean-to-deploy-a-machine-learning-model-dddb983ac416</a></p>
</div>
</section></section>
<section>
<section id="create-a-ml-workflow" class="title-slide slide level1 center">
<h1>10. Create a ML workflow</h1>

</section>
<section id="create-a-ml-workflow-1" class="slide level2">
<h2>10. Create a ML workflow</h2>
<ul>
<li><p>A machine learning workflow is a fully-scripted set of tasks that complete all steps in a machine learning pipeline</p></li>
<li><p>Tasks might include</p>
<ul>
<li><p>data ingestion</p></li>
<li><p>data pre-processing</p></li>
<li><p>parameter tuning over multiple algorithms</p></li>
<li><p>selecting the optimal model</p></li>
<li><p>create visual summaries</p></li>
<li><p>generate report</p></li>
<li><p>etc.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="targets">Targets</h3>
<ul>
<li><p>Can leverage the <a href="https://cran.r-project.org/web/packages/targets/index.html" title="https://cran.r-project.org/web/packages/targets/index.html"><code>targets</code></a> framework:</p>
<ul>
<li><p>Analyzes the dependency relationships among the tasks of a workflow</p></li>
<li><p>Skips steps that are already up to date</p></li>
<li><p>Runs the necessary computation with optional parallel workers</p></li>
<li><p>Abstracts files as R objects</p></li>
<li><p>Provides tangible evidence that the results match the underlying code and data.</p></li>
</ul></li>
<li><p>For details, visit the link to the <code>targets</code> manual provided in the resources section</p></li>
</ul>
</section></section>
<section>
<section id="closing-remarks" class="title-slide slide level1 center">
<h1>Closing remarks</h1>

</section>
<section id="closing-remarks-1" class="slide level2">
<h2>Closing remarks</h2>
<ul>
<li><p>In this introductory lecture, we discussed the 10 best practices of machine learning.</p></li>
<li><p>We will continue this discussion on Day 3 (October 12, 2022) for the hands-on workshop. I hope you will join us!</p>
<ul>
<li>Details about the workshop will be emailed to you.</li>
</ul></li>
<li><p>I hope you feel empowered to learn more about these apply these approaches in your work at Lilly.</p></li>
</ul>
</section></section>
<section>
<section id="resources" class="title-slide slide level1 center">
<h1>Resources</h1>

</section>
<section id="general-resources" class="slide level2">
<h2>General resources</h2>
<ul>
<li><p>2022 ML Workshop</p>
<ul>
<li><a href="https://github.com/sydeaka/machine-learning-workshop-2022">GitHub</a></li>
<li>ACTG 175 study used in demo
<ul>
<li>Data source/detail: https://www.rdocumentation.org/packages/speff2trial/versions/1.0.4/topics/ACTG175</li>
<li>Journal article: https://www.nejm.org/doi/10.1056/NEJM199610103351501</li>
</ul></li>
</ul></li>
<li><p>Machine learning algorithms</p></li>
<li><p>TidyModels workshop: <a href="https://workshops.tidymodels.org/">Slides</a>; <a href="https://github.com/tidymodels/workshops/tree/main/classwork">GitHub</a>; <a href="https://www.tmwr.org/">Book</a></p></li>
<li><p><a href="http://www.feat.engineering/">Feature Engineering book</a></p></li>
<li><p>Model deployment</p>
<ul>
<li><p><a href="https://solutions.rstudio.com/example/bike_predict/">Bike prediction demo</a></p></li>
<li><p><a href="https://juliasilge.com/blog/lego-sets/">LEGO set demo</a></p></li>
</ul></li>
</ul>
<div class="footer footer-default">
<p>2022 SDnA Machine Learning Workshop</p>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="2022_sdna_ML_workshop_day_2_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"6ab7eefcabb2c76d","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>